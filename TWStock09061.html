<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡äº¤æ˜“è¨ˆç®—å™¨ (V2.0.1)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', 'Arial', sans-serif;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 50%, rgba(231, 76, 60, 0.8) 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        /* èƒŒæ™¯æŸ”åŒ–æ•ˆæœ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.6) 0%, 
                rgba(118, 75, 162, 0.6) 25%,
                rgba(155, 89, 182, 0.5) 50%,
                rgba(231, 76, 60, 0.6) 75%,
                rgba(236, 112, 99, 0.5) 100%);
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px);
            z-index: -1;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        /* åº•éƒ¨è¨»è¨˜ */
        .footer-note {
            background: rgba(44, 62, 80, 0.9);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 0.9em;
            border-radius: 0 0 20px 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .menu-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #2c3e50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }

        /* å´é‚Šé¸å–® */
        .side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
            z-index: 999;
            padding: 80px 0 20px 0;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        }

        .side-menu.open {
            left: 0;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 998;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-item {
            display: block;
            padding: 20px 30px;
            color: white;
            text-decoration: none;
            font-size: 1.1em;
            font-weight: 500;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            padding-left: 40px;
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #3498db;
        }

        .menu-item.disabled {
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }

        .menu-item.disabled:hover {
            background: none;
            padding-left: 30px;
        }

        .menu-title {
            padding: 0 30px 20px 30px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db, #e74c3c);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .form-container {
            padding: 30px;
        }

        .info-box {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .info-box h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-family: inherit;
        }

        .info-box .tick-info {
            font-size: 0.9em;
            color: #555;
            font-family: inherit;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            font-family: inherit;
        }

        .required {
            color: #e74c3c;
            font-family: inherit;
        }

        select, input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        input[type="number"] {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* iOS Safari ç‰¹æ®Šè™•ç† */
        @supports (-webkit-touch-callout: none) {
            select, input {
                font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
            }
        }

        .price-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .price-input-container {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .stock-type-group, .mode-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* æ–°å¢æ¨¡å¼é¸æ“‡çš„ç¶²æ ¼ */
        .mode-group {
            grid-template-columns: 1fr 1fr;
        }
        
        @media (min-width: 600px) {
            .mode-group {
                grid-template-columns: 1fr 1fr 1fr 1fr;
            }
        }

        .radio-group {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            justify-content: center; /* ç½®ä¸­ */
        }

        .radio-group:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }

        .radio-group input[type="radio"] {
            display: none;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            font-size: 0.95em;
        }

        .radio-group label::before {
            content: '';
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 8px;
            transition: all 0.3s ease;
            vertical-align: middle;
            flex-shrink: 0;
        }

        .radio-group input[type="radio"]:checked + label::before {
            border-color: #3498db;
            background-color: #3498db;
            box-shadow: inset 0 0 0 3px white;
        }

        .radio-group.active {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        
        /* ç‰¹å®šæ¨¡å¼çš„é¡è‰²å€åˆ† */
        .radio-group.mode-short.active {
            border-color: #27ae60;
            background-color: #e8f5e9;
        }
        .radio-group.mode-short input[type="radio"]:checked + label::before {
            border-color: #27ae60;
            background-color: #27ae60;
        }

        .radio-group.mode-daytrade.active {
            border-color: #f39c12;
            background-color: #fef9e7;
        }
        .radio-group.mode-daytrade input[type="radio"]:checked + label::before {
            border-color: #f39c12;
            background-color: #f39c12;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #3498db 0%, #e74c3c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            background: linear-gradient(135deg, #2980b9 0%, #c0392b 100%);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .results {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .result-section {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-family: inherit;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-family: inherit;
        }

        .result-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1em;
        }

        .buy-section {
            border-left: 4px solid #27ae60;
        }

        .buy-section .result-item:last-child {
            color: #27ae60;
        }

        .sell-section {
            border-left: 4px solid #e74c3c;
        }

        .sell-section .result-item:last-child {
            color: #e74c3c;
        }
        
        .profit-section {
            border-left: 4px solid #f39c12;
        }

        .profit-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .profit-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .profit-zero {
            color: #7f8c8d;
            font-weight: bold;
        }
        
        .warning-text {
            color: #e74c3c;
            font-weight: bold;
            font-size: 0.9em;
        }

        .calculation-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #856404;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            .header {
                padding: 20px;
            }
            .header h1 {
                font-size: 1.6em;
            }
            .form-container {
                padding: 20px;
            }
            .price-group,
            .stock-type-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .calculate-btn {
                font-size: 1.1em;
                padding: 16px;
            }
            .result-item {
                font-size: 0.95em;
            }
            .menu-btn {
                width: 45px;
                height: 45px;
                top: 15px;
                left: 15px;
            }
            .side-menu {
                width: 250px;
                left: -250px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            .header h1 {
                font-size: 1.4em;
            }
            .form-container {
                padding: 15px;
            }
            .info-box {
                padding: 12px;
            }
            .info-box table {
                font-size: 0.85em;
            }
            .info-box th,
            .info-box td {
                padding: 6px !important;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .result-section {
                padding: 15px;
            }
            .result-item {
                font-size: 0.9em;
                padding: 6px 0;
            }
            .menu-btn {
                width: 40px;
                height: 40px;
                top: 10px;
                left: 10px;
                font-size: 1.3em;
            }
            .side-menu {
                width: 220px;
                left: -220px;
            }
            .footer-note {
                font-size: 0.8em;
                padding: 12px;
            }
        }

        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.2em;
            }
            .form-container {
                padding: 10px;
            }
            .info-box table {
                font-size: 0.8em;
            }
            .calculate-btn {
                font-size: 1em;
                padding: 14px;
            }
            .side-menu {
                width: 200px;
                left: -200px;
            }
        }
    </style>
</head>
<body>
    <button class="menu-btn" id="menuBtn">â˜°</button>

    <div class="menu-overlay" id="menuOverlay"></div>

    <nav class="side-menu" id="sideMenu">
        <div class="menu-title">ğŸ“Š äº¤æ˜“è¨ˆç®—å™¨</div>
        <a href="#" class="menu-item active" data-target="taiwan">
            å°è‚¡äº¤æ˜“
        </a>
        <a href="#" class="menu-item disabled" data-target="foreign">
            è¤‡å§”è¨—äº¤æ˜“ <span style="font-size: 0.8em; color: rgba(255,255,255,0.6);">(é–‹ç™¼ä¸­)</span>
        </a>
    </nav>

    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ å°è‚¡äº¤æ˜“è¨ˆç®—å™¨</h1>
            <p>ç²¾æº–è¨ˆç®—åšå¤šã€æ”¾ç©ºåŠç•¶æ²–æç›Š</p>
        </div>

        <div class="form-container">
            <div class="info-box">
                <h4>ğŸ“Š å°è‚¡åƒ¹æ ¼è·³å‹•å–®ä½åƒè€ƒè¡¨</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                     <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">è‚¡åƒ¹å€é–“</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">è·³å‹•å–®ä½</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">ç¯„ä¾‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">10å…ƒä»¥ä¸‹</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.01å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">9.98, 9.99, 10.00</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">10å…ƒ~æœªæ»¿50å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.05å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">10.00, 10.05, 10.10...49.95</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">50å…ƒ~æœªæ»¿100å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.1å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">50.0, 50.1, 50.2...99.9, 100.0</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">100å…ƒ~æœªæ»¿500å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.5å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">100.0, 100.5, 101.0...499.5, 500.0</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">500å…ƒ~æœªæ»¿1000å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">1å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">500, 501, 502...999, 1000</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">1000å…ƒä»¥ä¸Š</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">5å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">1000, 1005, 1010, 1015...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="calculation-note">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>èåˆ¸åŠç•¶æ²–è«‹æ³¨æ„åƒ¹æ ¼æ³¢å‹•èˆ‡ä¿è­‰é‡‘éœ€æ±‚ã€‚ç•¶æ²–è²·è³£åƒ¹å·®ä¸å¯è¶…é10%ã€‚
            </div>
            
            <form id="stockCalculator">
                <div class="form-group">
                    <label for="broker">åˆ¸å•†é¸æ“‡</label>
                    <select id="broker" required>
                        <option value="">è«‹é¸æ“‡åˆ¸å•†</option>
                        <option value="fubon">å¯Œé‚¦è­‰åˆ¸</option>
                        <option value="shinko">æ–°å…‰è­‰åˆ¸</option>
                        <option value="president">çµ±ä¸€è­‰åˆ¸</option>
                        <option value="sinopac">æ°¸è±è­‰åˆ¸</option>
                        <option value="taishin">å°æ–°è­‰åˆ¸</option>
                        <option value="pocketsec">å£è¢‹è­‰åˆ¸</option>
                        <option value="landbank">åœŸéŠ€è­‰åˆ¸</option>
                        <option value="bot">è‡ºéŠ€è­‰åˆ¸</option>
                        <option value="megasec">å…†è±è­‰åˆ¸</option>
                        <option value="tcbsec">åˆåº«è­‰åˆ¸</option>
                        <option value="changhuasec">å½°éŠ€è­‰åˆ¸</option>
                        <option value="ctbc">ä¸­åœ‹ä¿¡è¨—è­‰åˆ¸</option>
                        <option value="firstsec">ç¬¬ä¸€é‡‘è­‰åˆ¸</option>
                        <option value="sunnybank">é™½ä¿¡è­‰åˆ¸</option>
                        <option value="esun">ç‰å±±è­‰åˆ¸</option>
                        <option value="kgi">å‡±åŸºè­‰åˆ¸</option>
                        <option value="yuanta">å…ƒå¤§è­‰åˆ¸</option>
                        <option value="cathaysec">åœ‹æ³°è­‰åˆ¸</option>
                        <option value="capital">ç¾¤ç›Šè­‰åˆ¸</option>
                        <option value="masterlink">å…ƒå¯Œè­‰åˆ¸</option>
                        <option value="entrust">è¯å—æ°¸æ˜Œè­‰åˆ¸</option>
                        <option value="custom">ğŸ”§ è‡ªé¸æŠ˜æ•¸</option>
                    </select>
                </div>
                
                <div class="form-group" id="customDiscountGroup" style="display: none;">
                    <label for="customDiscount">è‡ªè¨‚æ‰‹çºŒè²»æŠ˜æ•¸</label>
                    <div class="price-group">
                        <div>
                            <label style="font-size: 0.9em; margin-bottom: 5px;">æŠ˜æ•¸ (ä¾‹ï¼š6æŠ˜å¡«6)</label>
                            <input type="number" id="customDiscount" step="0.1" min="0.1" max="10" placeholder="è«‹è¼¸å…¥æŠ˜æ•¸">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; margin-bottom: 5px;">é›¶è‚¡æœ€ä½æ‰‹çºŒè²» (å…ƒ)</label>
                            <input type="number" id="customMinFee" step="1" min="1" max="50" placeholder="é è¨­1å…ƒ" value="1">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>äº¤æ˜“æ¨¡å¼ <span class="required">*å¿…é¸</span></label>
                    <div class="mode-group">
                        <div class="radio-group active">
                            <input type="radio" id="modeSpot" name="tradeMode" value="spot" checked>
                            <label for="modeSpot">ç¾è‚¡åšå¤š</label>
                        </div>
                        <div class="radio-group mode-short">
                            <input type="radio" id="modeMarginShort" name="tradeMode" value="margin_short">
                            <label for="modeMarginShort">èåˆ¸æ”¾ç©º</label>
                        </div>
                        <div class="radio-group mode-daytrade">
                            <input type="radio" id="modeDayLong" name="tradeMode" value="day_long">
                            <label for="modeDayLong">æ²–è²·(å…ˆè²·è³£)</label>
                        </div>
                         <div class="radio-group mode-daytrade">
                            <input type="radio" id="modeDayShort" name="tradeMode" value="day_short">
                            <label for="modeDayShort">æ²–è³£(å…ˆè³£è²·)</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>è‚¡ç¥¨åƒ¹æ ¼ <span style="font-size: 0.9em; color: #666;">(è«‹ä¾äº¤æ˜“é †åºå¡«å¯«)</span></label>
                    <div class="price-group">
                        <div class="price-input-container">
                            <label for="inputPrice1" style="font-size: 0.9em; margin-bottom: 5px;" id="priceLabel1">è²·é€²åƒ¹æ ¼ (å…ƒ)</label>
                            <input type="number" id="inputPrice1" step="0.01" min="0" placeholder="åƒ¹æ ¼">
                        </div>
                        <div class="price-input-container">
                            <label for="inputPrice2" style="font-size: 0.9em; margin-bottom: 5px;" id="priceLabel2">è³£å‡ºåƒ¹æ ¼ (å…ƒ)</label>
                            <input type="number" id="inputPrice2" step="0.01" min="0" placeholder="åƒ¹æ ¼">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>äº¤æ˜“é¡å‹ <span class="required">*å¿…é¸</span></label>
                    <div class="stock-type-group">
                        <div class="radio-group">
                            <input type="radio" id="lot" name="stockType" value="lot" required>
                            <label for="lot">æ•´å¼µäº¤æ˜“</label>
                        </div>
                        <div class="radio-group">
                            <input type="radio" id="odd" name="stockType" value="odd" required>
                            <label for="odd">é›¶è‚¡äº¤æ˜“</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="quantity" id="quantityLabel">æ•¸é‡ <span class="required">*å¿…é¸</span></label>
                    <input type="number" id="quantity" min="1" placeholder="è«‹è¼¸å…¥æ•¸é‡ (é è¨­ç‚º1)" value="1">
                </div>
                
                <button type="submit" class="calculate-btn">ğŸ’° è¨ˆç®—äº¤æ˜“æˆæœ¬èˆ‡ç²åˆ©</button>
            </form>
            
            <div id="results" class="results">
                <div id="dynamicResultContent"></div>
            </div>
        </div>
        
        <div class="footer-note">
            âš ï¸ è¨»ï¼šäº¤æ˜“æœ‰è³ºæœ‰è³ ï¼Œèåˆ¸åŠç•¶æ²–é¢¨éšªè¼ƒé«˜ï¼Œè«‹å°å¿ƒäº¤æ˜“ã€‚æ‰€æœ‰è¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒã€‚
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM å…ƒç´ åƒç…§ ---
            const form = document.getElementById('stockCalculator');
            const brokerSelect = document.getElementById('broker');
            const customDiscountGroup = document.getElementById('customDiscountGroup');
            const customDiscountInput = document.getElementById('customDiscount');
            const customMinFeeInput = document.getElementById('customMinFee');
            const quantityInput = document.getElementById('quantity');
            const quantityLabel = document.getElementById('quantityLabel');
            const resultsDiv = document.getElementById('results');
            const dynamicResultContent = document.getElementById('dynamicResultContent');
            const radioGroups = document.querySelectorAll('.radio-group');
            
            // åƒ¹æ ¼è¼¸å…¥æ¡†ç¾åœ¨ä½¿ç”¨é€šç”¨ID
            const inputPrice1 = document.getElementById('inputPrice1');
            const inputPrice2 = document.getElementById('inputPrice2');
            const priceLabel1 = document.getElementById('priceLabel1');
            const priceLabel2 = document.getElementById('priceLabel2');
            
            const menuBtn = document.getElementById('menuBtn');
            const sideMenu = document.getElementById('sideMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            const menuItems = document.querySelectorAll('.menu-item');

            // --- é¸å–®æ§åˆ¶å‡½å¼ ---
            function toggleMenu() {
                sideMenu.classList.toggle('open');
                menuOverlay.classList.toggle('active');
            }
            
            function selectMenuItem(selectedItem) {
                if (selectedItem.classList.contains('disabled')) return;
                menuItems.forEach(item => item.classList.remove('active'));
                selectedItem.classList.add('active');
                closeMenu();
            }
            
            function closeMenu() {
                sideMenu.classList.remove('open');
                menuOverlay.classList.remove('active');
            }

            // --- è¨ˆç®—å™¨è¼”åŠ©å‡½å¼ ---
            function formatNumber(num) {
                if (typeof num !== 'number') return num;
                return num.toLocaleString('en-US');
            }
            
            // é¡¯ç¤ºéŒ¯èª¤æç¤º
            function showError(message) {
                alert(`âŒ è¨ˆç®—éŒ¯èª¤ï¼š\n${message}`);
            }

            // --- UI äº’å‹•å‡½å¼ ---
            function updateUIForMode(modeId) {
                // ç§»é™¤æ‰€æœ‰ active æ¨£å¼ä¸¦é‡è¨­
                document.querySelectorAll('input[name="tradeMode"]').forEach(input => {
                     const group = input.closest('.radio-group');
                     if(group) group.classList.remove('active');
                });
                
                const selectedInput = document.getElementById(modeId);
                if(selectedInput) {
                     selectedInput.checked = true;
                     selectedInput.closest('.radio-group').classList.add('active');
                     
                     // æ›´æ–°åƒ¹æ ¼æ¨™ç±¤ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“å¡«å¯«é †åº
                     if (modeId === 'modeMarginShort' || modeId === 'modeDayShort') {
                         // å…ˆè³£å¾Œè²· (ç©ºå–®)
                         priceLabel1.textContent = 'è³£å‡º/æ”¾ç©ºåƒ¹æ ¼ (å…ƒ)';
                         priceLabel2.textContent = 'è²·é€²/å›è£œåƒ¹æ ¼ (å…ƒ)';
                     } else {
                         // å…ˆè²·å¾Œè³£ (å¤šå–®)
                         priceLabel1.textContent = 'è²·é€²åƒ¹æ ¼ (å…ƒ)';
                         priceLabel2.textContent = 'è³£å‡ºåƒ¹æ ¼ (å…ƒ)';
                     }
                }
            }

            function selectStockType(type) {
                // è™•ç†äº¤æ˜“é¡å‹ (æ•´å¼µ/é›¶è‚¡) çš„é¸å–æ¨£å¼
                document.querySelectorAll('input[name="stockType"]').forEach(input => {
                     const group = input.closest('.radio-group');
                     if(group) group.classList.remove('active');
                });

                const selectedRadio = document.getElementById(type);
                if (selectedRadio) {
                    selectedRadio.checked = true;
                    const parentGroup = selectedRadio.closest('.radio-group');
                    if(parentGroup) parentGroup.classList.add('active');
                    
                    if (type === 'lot') {
                        quantityLabel.innerHTML = 'å¼µæ•¸ <span class="required">*å¿…é¸</span>';
                        quantityInput.placeholder = 'è«‹è¼¸å…¥å¼µæ•¸ (é è¨­ç‚º1)';
                    } else {
                        quantityLabel.innerHTML = 'è‚¡æ•¸ <span class="required">*å¿…é¸</span>';
                        quantityInput.placeholder = 'è«‹è¼¸å…¥è‚¡æ•¸ (é è¨­ç‚º1)';
                    }
                }
            }

            function handleBrokerChange() {
                customDiscountGroup.style.display = (brokerSelect.value === 'custom') ? 'block' : 'none';
                customDiscountInput.required = (brokerSelect.value === 'custom');
            }
            
            // ç›£è½äº¤æ˜“æ¨¡å¼è®ŠåŒ–
            document.querySelectorAll('input[name="tradeMode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updateUIForMode(this.id);
                });
            });

            // --- æ ¸å¿ƒè¨ˆç®—é‚è¼¯ ---
            function getBrokerInfo(broker, stockAmount) {
                let info = { discountRate: 0.6, name: 'åˆ¸å•†', minFeeRegular: 20, minFeeOdd: 1 };
                switch (broker) {
                    case 'fubon': info = { ...info, discountRate: stockAmount >= 1000000 ? 0.6 : 0.18, name: 'å¯Œé‚¦' }; break;
                    case 'shinko': info = { ...info, discountRate: 0.1, name: 'æ–°å…‰' }; break;
                    case 'president': info = { ...info, discountRate: 0.168, name: 'çµ±ä¸€', minFeeRegular: 1 }; break;
                    case 'sinopac': info = { ...info, discountRate: 0.28, name: 'æ°¸è±' }; break; 
                    case 'pocketsec': info = { ...info, discountRate: 0.28, name: 'å£è¢‹' }; break; 
                    case 'kgi': info = { ...info, discountRate: 0.6, name: 'å‡±åŸº' }; break; 
                    case 'yuanta': info = { ...info, discountRate: 0.6, name: 'å…ƒå¤§' }; break; 
                    case 'custom':
                        const customDiscount = parseFloat(customDiscountInput.value);
                        const customMinFee = parseInt(customMinFeeInput.value) || 1;
                        info = { discountRate: customDiscount / 10, name: `è‡ªé¸${customDiscount}æŠ˜`, minFeeRegular: 20, minFeeOdd: customMinFee };
                        break;
                    default: 
                        const selectedOption = brokerSelect.querySelector(`option[value="${broker}"]`);
                        if(selectedOption) info.name = selectedOption.textContent.replace('è­‰åˆ¸', '');
                        break;
                }
                return info;
            }

            function calculateCommission(stockAmount, brokerInfo, stockType) {
                const minFee = stockType === 'lot' ? brokerInfo.minFeeRegular : brokerInfo.minFeeOdd;
                const calculatedFee = stockAmount * 0.001425 * brokerInfo.discountRate;
                return Math.max(minFee, Math.round(calculatedFee));
            }

            function validatePriceLimit(buyPrice, sellPrice) {
                if (!buyPrice || !sellPrice) return true;
                const diff = Math.abs(buyPrice - sellPrice);
                // ä»¥è²·è³£åƒ¹æ ¼ä¸­è¼ƒé«˜è€…ç•¶åˆ†æ¯æœƒæ¯”è¼ƒå¯¬é¬†ï¼Œé€™è£¡ä»¥è¼ƒä½åƒ¹ç‚ºåŸºæº–ä¾†åšåš´æ ¼åˆ¤æ–·
                const base = Math.min(buyPrice, sellPrice); 
                const ratio = diff / base; 
                // å°è‚¡æ¼²è·Œå¹…10%ï¼Œç°¡å–®æª¢æ ¸æ˜¯å¦è¶…é 10.5% å¹…åº¦ä½œç‚ºè­¦ç¤º
                return ratio <= 0.105; 
            }
            
            // --- çµæœæ¸²æŸ“ ---
            function generateResultHTML(data) {
                const {
                    mode, buyStockAmount, sellStockAmount,
                    buyCommission, sellCommission, tax,
                    totalBuyCost, netSellProceeds, // é€™äº›æ˜¯ç¾é‡‘æµæ¦‚å¿µ
                    profitAmount, profitRate,
                    buyBrokerInfo, sellBrokerInfo,
                    buyCommissionOriginal, sellCommissionOriginal,
                    marginDeposit, maintenanceRatio, // èåˆ¸ç‰¹æœ‰
                    hasBuy, hasSell, taxRateDisplay
                } = data;

                let html = '';
                
                // å€å¡Š 1: è²·é€²/å›è£œ æ˜ç´°
                if (hasBuy) {
                    const title = (mode === 'margin_short' || mode === 'day_short') ? 'ğŸ”´ å›è£œè²·é€²æˆæœ¬' : 'ğŸŸ¢ è²·å…¥æˆæœ¬';
                    const cssClass = (mode === 'margin_short' || mode === 'day_short') ? 'sell-section' : 'buy-section'; // å›è£œç®—æ˜¯ä¸€ç¨®"çµæŸç©ºå–®"çš„è¡Œç‚º
                    
                    html += `
                    <div class="result-section ${cssClass}">
                        <h3>${title}</h3>
                        <div class="result-item">
                            <span>è‚¡ç¥¨é‡‘é¡ï¼š</span>
                            <span>NT$ ${formatNumber(buyStockAmount)}</span>
                        </div>
                        <div class="result-item">
                            <span>æ‰‹çºŒè²» (0.1425%)ï¼š</span>
                            <span>NT$ ${formatNumber(buyCommission)} <small style="color:#888">(${buyCommissionOriginal})</small></span>
                        </div>
                        <div class="result-item">
                            <span>ç¸½è²·å…¥/å›è£œæ”¯å‡ºï¼š</span>
                            <span>NT$ ${formatNumber(totalBuyCost)}</span>
                        </div>
                    </div>`;
                }

                // å€å¡Š 2: è³£å‡º/æ”¾ç©º æ˜ç´°
                if (hasSell) {
                    const title = (mode === 'margin_short' || mode === 'day_short') ? 'ğŸŸ¢ æ”¾ç©ºè³£å‡ºæ”¶ç›Š (æš«å­˜)' : 'ğŸ”´ è³£å‡ºæ”¶ç›Š';
                    const cssClass = (mode === 'margin_short' || mode === 'day_short') ? 'buy-section' : 'sell-section';
                    
                    let extraRows = '';
                    if (mode === 'margin_short') {
                         extraRows += `
                         <div class="result-item" style="color: #8e44ad; font-weight:bold;">
                            <span>èåˆ¸ä¿è­‰é‡‘ (90%)ï¼š</span>
                            <span>NT$ ${formatNumber(marginDeposit)}</span>
                        </div>
                        <div class="result-item">
                             <span style="font-size:0.85em; color:#666;">(æ“”ä¿å“ç¸½å€¼ = è³£å‡ºæ”¶ç›Š + ä¿è­‰é‡‘)</span>
                        </div>
                         `;
                    }

                    html += `
                    <div class="result-section ${cssClass}">
                        <h3>${title}</h3>
                        <div class="result-item">
                            <span>è‚¡ç¥¨é‡‘é¡ï¼š</span>
                            <span>NT$ ${formatNumber(sellStockAmount)}</span>
                        </div>
                        <div class="result-item">
                            <span>æ‰‹çºŒè²» (0.1425%)ï¼š</span>
                            <span>NT$ ${formatNumber(sellCommission)} <small style="color:#888">(${sellCommissionOriginal})</small></span>
                        </div>
                        <div class="result-item">
                            <span>è­‰åˆ¸äº¤æ˜“ç¨… (${taxRateDisplay})ï¼š</span>
                            <span>NT$ ${formatNumber(tax)}</span>
                        </div>
                        ${extraRows}
                        <div class="result-item">
                            <span>æ·¨è³£å‡ºæ”¶ç›Šï¼š</span>
                            <span>NT$ ${formatNumber(netSellProceeds)}</span>
                        </div>
                    </div>`;
                }

                // å€å¡Š 3: æç›Šåˆ†æ
                if (hasBuy && hasSell) {
                    let profitClass = profitAmount > 0 ? 'profit-positive' : (profitAmount < 0 ? 'profit-negative' : 'profit-zero');
                    let extraProfitRows = '';
                    
                    if (mode === 'margin_short' && maintenanceRatio !== null) {
                        const ratioClass = maintenanceRatio < 130 ? 'warning-text' : 'profit-positive';
                        extraProfitRows += `
                        <div class="result-item">
                            <span>é ä¼°ç¶­æŒç‡ï¼š</span>
                            <span class="${ratioClass}">${maintenanceRatio.toFixed(2)}% ${maintenanceRatio < 130 ? '(è¿½ç¹³!)' : ''}</span>
                        </div>`;
                    }

                    const totalCosts = buyCommission + sellCommission + tax;

                    html += `
                    <div class="result-section profit-section">
                        <h3>ğŸ“Š æç›Šåˆ†æ</h3>
                        <div class="result-item">
                             <span>äº¤æ˜“æ¨¡å¼ï¼š</span>
                             <span style="font-weight:bold;">${getModeName(mode)}</span>
                        </div>
                        <div class="result-item">
                            <span>ç¸½äº¤æ˜“æˆæœ¬ (æ‰‹çºŒè²»+ç¨…)ï¼š</span>
                            <span>NT$ ${formatNumber(totalCosts)}</span>
                        </div>
                        ${extraProfitRows}
                        <div class="result-item">
                            <span>æœ€çµ‚æç›Šï¼š</span>
                            <span class="${profitClass}" style="font-size: 1.3em;">NT$ ${formatNumber(profitAmount)}</span>
                        </div>
                        <div class="result-item">
                            <span>å ±é…¬ç‡ï¼š</span>
                            <span class="${profitClass}">${profitRate.toFixed(2)}%</span>
                        </div>
                    </div>`;
                }
                
                return html;
            }
            
            function getModeName(mode) {
                switch(mode) {
                    case 'spot': return 'ç¾è‚¡åšå¤š';
                    case 'margin_short': return 'èåˆ¸æ”¾ç©º';
                    case 'day_long': return 'ç¾è‚¡ç•¶æ²– (å…ˆè²·å¾Œè³£)';
                    case 'day_short': return 'ç¾è‚¡ç•¶æ²– (å…ˆè³£å¾Œè²·)';
                    default: return 'æœªçŸ¥';
                }
            }

            // --- è¡¨å–®æäº¤è™•ç† ---
            function handleFormSubmit(event) {
                event.preventDefault();
                const broker = brokerSelect.value;
                // å–å¾—åŸå§‹è¼¸å…¥å€¼
                const p1Value = parseFloat(inputPrice1.value) || null;
                const p2Value = parseFloat(inputPrice2.value) || null;
                
                const stockTypeElement = document.querySelector('input[name="stockType"]:checked');
                const tradeModeElement = document.querySelector('input[name="tradeMode"]:checked');
                let quantity = parseInt(quantityInput.value) || 1;

                // --- éŒ¯èª¤æª¢æŸ¥é–‹å§‹ ---
                if (!broker) return showError('è«‹é¸æ“‡ä¸€å®¶åˆ¸å•†ï¼');
                if (!tradeModeElement) return showError('è«‹é¸æ“‡äº¤æ˜“æ¨¡å¼ï¼');
                if (!stockTypeElement) return showError('è«‹é¸æ“‡äº¤æ˜“é¡å‹ (æ•´å¼µ/é›¶è‚¡)ï¼');
                if (!p1Value && !p2Value) return showError('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹åƒ¹æ ¼ï¼');
                
                if (broker === 'custom') {
                    if (!customDiscountInput.value || parseFloat(customDiscountInput.value) <= 0 || parseFloat(customDiscountInput.value) > 10) {
                        return showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„è‡ªè¨‚æŠ˜æ•¸ (ç¯„åœ 0.1 - 10)ï¼');
                    }
                }
                // --- éŒ¯èª¤æª¢æŸ¥çµæŸ ---

                const mode = tradeModeElement.value;
                
                // --- é—œéµä¿®æ­£ï¼šæ ¹æ“šæ¨¡å¼æŒ‡æ´¾ è²·å…¥åƒ¹ èˆ‡ è³£å‡ºåƒ¹ ---
                let buyPrice = null;
                let sellPrice = null;

                if (mode === 'spot' || mode === 'day_long') {
                    // åšå¤šæ¨¡å¼ï¼šè¼¸å…¥1=è²·é€²ï¼Œè¼¸å…¥2=è³£å‡º
                    buyPrice = p1Value;
                    sellPrice = p2Value;
                } else {
                    // æ”¾ç©ºæ¨¡å¼ï¼šè¼¸å…¥1=è³£å‡º(æ”¾ç©º)ï¼Œè¼¸å…¥2=è²·é€²(å›è£œ)
                    sellPrice = p1Value;
                    buyPrice = p2Value;
                }

                // ç•¶æ²–æª¢æŸ¥æ¼²è·Œå¹…
                if ((mode === 'day_long' || mode === 'day_short') && buyPrice && sellPrice) {
                    if (!validatePriceLimit(buyPrice, sellPrice)) {
                         if(!confirm("âš ï¸ è­¦å‘Šï¼šè²·è³£åƒ¹å·®éå¤§ (>10%)ï¼Œå¯èƒ½ä¸ç¬¦åˆå°è‚¡ç•¶æ—¥æ¼²è·Œå¹…é™åˆ¶ã€‚\n\næ˜¯å¦ç¹¼çºŒè¨ˆç®—ï¼Ÿ")) {
                             return;
                         }
                    }
                }

                const stockType = stockTypeElement.value;
                const sharesPerUnit = stockType === 'lot' ? 1000 : 1;

                let buyStockAmount = 0, sellStockAmount = 0;
                let buyCommission = 0, sellCommission = 0;
                let buyCommissionOriginal = 0, sellCommissionOriginal = 0;
                let tax = 0, totalBuyCost = 0, netSellProceeds = 0;
                let buyBrokerInfo = {}, sellBrokerInfo = {};
                let taxRate = 0.003; // é è¨­ç¨…ç‡
                let taxRateDisplay = "0.3%";
                
                // è¨­å®šç¨…ç‡
                if (mode === 'day_long' || mode === 'day_short') {
                    taxRate = 0.0015;
                    taxRateDisplay = "0.15%";
                }

                // è¨ˆç®—è²·å…¥éƒ¨åˆ† (ç¾è‚¡è²·é€² æˆ– å›è£œ)
                if (buyPrice) {
                    buyStockAmount = buyPrice * quantity * sharesPerUnit;
                    buyBrokerInfo = getBrokerInfo(broker, buyStockAmount);
                    buyCommissionOriginal = Math.round(buyStockAmount * 0.001425);
                    buyCommission = calculateCommission(buyStockAmount, buyBrokerInfo, stockType);
                    totalBuyCost = buyStockAmount + buyCommission;
                }

                // è¨ˆç®—è³£å‡ºéƒ¨åˆ† (ç¾è‚¡è³£å‡º æˆ– æ”¾ç©º)
                if (sellPrice) {
                    sellStockAmount = sellPrice * quantity * sharesPerUnit;
                    sellBrokerInfo = getBrokerInfo(broker, sellStockAmount);
                    sellCommissionOriginal = Math.round(sellStockAmount * 0.001425);
                    sellCommission = calculateCommission(sellStockAmount, sellBrokerInfo, stockType);
                    tax = Math.round(sellStockAmount * taxRate);
                    netSellProceeds = sellStockAmount - sellCommission - tax;
                }
                
                // è¨ˆç®—æç›Š
                let profitAmount = 0, profitRate = 0;
                let marginDeposit = 0;
                let maintenanceRatio = null;
                
                if (buyPrice && sellPrice) {
                    // é€šç”¨æç›Šå…¬å¼ï¼š(è³£å‡ºæ·¨æ”¶ - è²·å…¥ç¸½æ”¯)
                    // æ³¨æ„ï¼šé€™å·²ç¶“åŒ…å«äº†æ‰‹çºŒè²»èˆ‡ç¨…
                    profitAmount = netSellProceeds - totalBuyCost; 
                    
                    let costBase = 0;

                    if (mode === 'spot' || mode === 'day_long') {
                        // åšå¤šæˆæœ¬ = è²·å…¥æˆæœ¬
                        costBase = totalBuyCost;
                    } else if (mode === 'margin_short') {
                        // èåˆ¸æ”¾ç©º
                        // æˆæœ¬ = ä¿è­‰é‡‘ (90%)
                        // å¦å¤–è¨ˆç®—ç¶­æŒç‡
                        marginDeposit = Math.round(sellStockAmount * 0.9);
                        costBase = marginDeposit; // å ±é…¬ç‡åˆ†æ¯é€šå¸¸ç”¨è‡ªæœ‰è³‡é‡‘(ä¿è­‰é‡‘)ç®—
                        
                        // ç¶­æŒç‡ = (èåˆ¸æ“”ä¿å“ + ä¿è­‰é‡‘) / è‚¡ç¥¨å¸‚å€¼
                        // èåˆ¸æ“”ä¿å“ = è³£å‡ºæ‰£é™¤è²»ç¨…å¾Œçš„éŒ¢ (netSellProceeds)
                        // è‚¡ç¥¨å¸‚å€¼ = ç›®å‰è‚¡åƒ¹(è²·å›åƒ¹) * è‚¡æ•¸ (buyStockAmount)
                        const collateral = netSellProceeds + marginDeposit;
                        if (buyStockAmount > 0) {
                            maintenanceRatio = (collateral / buyStockAmount) * 100;
                        }
                        
                    } else if (mode === 'day_short') {
                        // ç•¶æ²–å…ˆè³£å¾Œè²·
                        // æˆæœ¬é€šå¸¸è¦–ç‚º 0 (ç„¡æœ¬ç•¶æ²–)ï¼Œä½†è¨ˆç®—å ±é…¬ç‡æ™‚åˆ†æ¯ä¸èƒ½ç‚º0
                        // ä¸€èˆ¬ç¿’æ…£ç”¨è³£å‡ºé‡‘é¡æˆ–ä¿è­‰é‡‘ç•¶åˆ†æ¯ï¼Œé€™è£¡ç‚ºäº†é¿å…ç„¡é™å¤§ï¼Œç”¨è³£å‡ºé‡‘é¡ç•¶åƒè€ƒæˆæœ¬
                        costBase = sellStockAmount; 
                    }

                    profitRate = costBase > 0 ? (profitAmount / costBase) * 100 : 0;
                }

                // æ¸²æŸ“ç•«é¢
                const html = generateResultHTML({
                    mode,
                    buyStockAmount: Math.round(buyStockAmount),
                    sellStockAmount: Math.round(sellStockAmount),
                    buyCommission, sellCommission,
                    buyCommissionOriginal, sellCommissionOriginal,
                    tax, taxRateDisplay,
                    totalBuyCost, netSellProceeds,
                    profitAmount: Math.round(profitAmount),
                    profitRate,
                    buyBrokerInfo, sellBrokerInfo,
                    marginDeposit, maintenanceRatio,
                    hasBuy: !!buyPrice,
                    hasSell: !!sellPrice
                });
                
                dynamicResultContent.innerHTML = html;
                resultsDiv.style.display = 'block';
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            }

            // --- äº‹ä»¶ç›£è½å™¨åˆå§‹åŒ– ---
            function initializeEventListeners() {
                form.addEventListener('submit', handleFormSubmit);
                brokerSelect.addEventListener('change', handleBrokerChange);
                
                radioGroups.forEach(group => {
                    group.addEventListener('click', function (e) {
                        // é˜²æ­¢è§¸ç™¼å…©æ¬¡ (label é»æ“Š)
                        if(e.target.tagName === 'LABEL') return;
                        
                        const radioInput = this.querySelector('input[type="radio"]');
                        if (radioInput) {
                             if(radioInput.name === 'stockType') selectStockType(radioInput.id);
                             if(radioInput.name === 'tradeMode') updateUIForMode(radioInput.id);
                        }
                    });
                });
                
                menuBtn.addEventListener('click', toggleMenu);
                menuOverlay.addEventListener('click', closeMenu);

                menuItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        selectMenuItem(this);
                    });
                });
            }

            // --- ç¨‹å¼é€²å…¥é» ---
            initializeEventListeners();
        });
    </script>
</body>
</html>
