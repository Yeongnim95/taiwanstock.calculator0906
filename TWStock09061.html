<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡äº¤æ˜“é‡‘é¡è¨ˆç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', 'Arial', sans-serif;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 50%, rgba(231, 76, 60, 0.8) 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        /* èƒŒæ™¯æŸ”åŒ–æ•ˆæœ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.6) 0%, 
                rgba(118, 75, 162, 0.6) 25%,
                rgba(155, 89, 182, 0.5) 50%,
                rgba(231, 76, 60, 0.6) 75%,
                rgba(236, 112, 99, 0.5) 100%);
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px);
            z-index: -1;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        /* åº•éƒ¨è¨»è¨˜ */
        .footer-note {
            background: rgba(44, 62, 80, 0.9);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 0.9em;
            border-radius: 0 0 20px 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .menu-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #2c3e50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }

        /* å´é‚Šé¸å–® */
        .side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
            z-index: 999;
            padding: 80px 0 20px 0;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        }

        .side-menu.open {
            left: 0;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 998;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-item {
            display: block;
            padding: 20px 30px;
            color: white;
            text-decoration: none;
            font-size: 1.1em;
            font-weight: 500;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            padding-left: 40px;
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #3498db;
        }

        .menu-item.disabled {
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
        }

        .menu-item.disabled:hover {
            background: none;
            padding-left: 30px;
        }

        .menu-title {
            padding: 0 30px 20px 30px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db, #e74c3c);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .form-container {
            padding: 30px;
        }

        .info-box {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .info-box h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-family: inherit;
        }

        .info-box .tick-info {
            font-size: 0.9em;
            color: #555;
            font-family: inherit;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            font-family: inherit;
        }

        .required {
            color: #e74c3c;
            font-family: inherit;
        }

        select, input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        input[type="number"] {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* iOS Safari ç‰¹æ®Šè™•ç† */
        @supports (-webkit-touch-callout: none) {
            select, input {
                font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
            }
        }

        .price-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .price-input-container {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .stock-type-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .radio-group {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .radio-group:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }

        .radio-group input[type="radio"] {
            display: none;
        }
        
        .radio-group label::before {
            content: '';
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 10px;
            transition: all 0.3s ease;
            vertical-align: middle;
        }

        .radio-group input[type="radio"]:checked + label::before {
            border-color: #3498db;
            background-color: #3498db;
            box-shadow: inset 0 0 0 3px white;
        }

        .radio-group.active {
            border-color: #3498db;
            background-color: #e3f2fd;
        }

        .radio-group label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #3498db 0%, #e74c3c 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            background: linear-gradient(135deg, #2980b9 0%, #c0392b 100%);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .results {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .result-section {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-family: inherit;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-family: inherit;
        }

        .result-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1em;
        }

        .buy-section {
            border-left: 4px solid #27ae60;
        }

        .buy-section .result-item:last-child {
            color: #27ae60;
        }

        .sell-section {
            border-left: 4px solid #e74c3c;
        }

        .sell-section .result-item:last-child {
            color: #e74c3c;
        }

        .profit-section {
            border-left: 4px solid #f39c12;
        }

        .profit-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .profit-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .profit-zero {
            color: #7f8c8d;
            font-weight: bold;
        }

        .calculation-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #856404;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            .header {
                padding: 20px;
            }
            .header h1 {
                font-size: 1.6em;
            }
            .form-container {
                padding: 20px;
            }
            .price-group,
            .stock-type-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .calculate-btn {
                font-size: 1.1em;
                padding: 16px;
            }
            .result-item {
                font-size: 0.95em;
            }
            .menu-btn {
                width: 45px;
                height: 45px;
                top: 15px;
                left: 15px;
            }
            .side-menu {
                width: 250px;
                left: -250px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            .header h1 {
                font-size: 1.4em;
            }
            .form-container {
                padding: 15px;
            }
            .info-box {
                padding: 12px;
            }
            .info-box table {
                font-size: 0.85em;
            }
            .info-box th,
            .info-box td {
                padding: 6px !important;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .result-section {
                padding: 15px;
            }
            .result-item {
                font-size: 0.9em;
                padding: 6px 0;
            }
            .menu-btn {
                width: 40px;
                height: 40px;
                top: 10px;
                left: 10px;
                font-size: 1.3em;
            }
            .side-menu {
                width: 220px;
                left: -220px;
            }
            .footer-note {
                font-size: 0.8em;
                padding: 12px;
            }
        }

        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.2em;
            }
            .form-container {
                padding: 10px;
            }
            .info-box table {
                font-size: 0.8em;
            }
            .calculate-btn {
                font-size: 1em;
                padding: 14px;
            }
            .side-menu {
                width: 200px;
                left: -200px;
            }
        }
    </style>
</head>
<body>
    <button class="menu-btn" id="menuBtn">â˜°</button>

    <div class="menu-overlay" id="menuOverlay"></div>

    <nav class="side-menu" id="sideMenu">
        <div class="menu-title">ğŸ“Š äº¤æ˜“è¨ˆç®—å™¨</div>
        <a href="#" class="menu-item active" data-target="taiwan">
            å°è‚¡äº¤æ˜“
        </a>
        <a href="#" class="menu-item disabled" data-target="foreign">
            è¤‡å§”è¨—äº¤æ˜“ <span style="font-size: 0.8em; color: rgba(255,255,255,0.6);">(é–‹ç™¼ä¸­)</span>
        </a>
    </nav>

    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ å°è‚¡äº¤æ˜“è¨ˆç®—å™¨</h1>
            <p>ç²¾æº–è¨ˆç®—æ‚¨çš„è‚¡ç¥¨äº¤æ˜“æˆæœ¬èˆ‡ç²åˆ©</p>
        </div>

        <div class="form-container">
            <div class="info-box">
                <h4>ğŸ“Š å°è‚¡åƒ¹æ ¼è·³å‹•å–®ä½åƒè€ƒè¡¨</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                     <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">è‚¡åƒ¹å€é–“</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">è·³å‹•å–®ä½</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">ç¯„ä¾‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">10å…ƒä»¥ä¸‹</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.01å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">9.98, 9.99, 10.00</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">10å…ƒ~æœªæ»¿50å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.05å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">10.00, 10.05, 10.10...49.95</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">50å…ƒ~æœªæ»¿100å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.1å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">50.0, 50.1, 50.2...99.9, 100.0</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">100å…ƒ~æœªæ»¿500å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.5å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">100.0, 100.5, 101.0...499.5, 500.0</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">500å…ƒ~æœªæ»¿1000å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">1å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">500, 501, 502...999, 1000</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">1000å…ƒä»¥ä¸Š</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">5å…ƒ</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">1000, 1005, 1010, 1015...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="calculation-note">
                ğŸ’¡ <strong>ä½¿ç”¨æç¤ºï¼š</strong>æ‚¨å¯ä»¥åªå¡«å…¥å–®é‚Šåƒ¹æ ¼è¨ˆç®—æˆæœ¬ï¼Œæˆ–åŒæ™‚å¡«å…¥å…©é‚Šåƒ¹æ ¼è¨ˆç®—å®Œæ•´æç›Šã€‚
            </div>
            
            <form id="stockCalculator">
                <div class="form-group">
                    <label for="broker">åˆ¸å•†é¸æ“‡</label>
                    <select id="broker" required>
                        <option value="">è«‹é¸æ“‡åˆ¸å•†</option>
                        <option value="fubon">å¯Œé‚¦è­‰åˆ¸</option>
                        <option value="shinko">æ–°å…‰è­‰åˆ¸</option>
                        <option value="president">çµ±ä¸€è­‰åˆ¸</option>
                        <option value="sinopac">æ°¸è±é‡‘è­‰åˆ¸</option>
                        <option value="taishin">å°æ–°è­‰åˆ¸</option>
                        <option value="pocketsec">å£è¢‹è­‰åˆ¸</option>
                        <option value="landbank">åœŸéŠ€è­‰åˆ¸</option>
                        <option value="bot">è‡ºéŠ€è­‰åˆ¸</option>
                        <option value="megasec">å…†è±è­‰åˆ¸</option>
                        <option value="tcbsec">åˆåº«è­‰åˆ¸</option>
                        <option value="changhuasec">å½°éŠ€è­‰åˆ¸</option>
                        <option value="ctbc">ä¸­åœ‹ä¿¡è¨—è­‰åˆ¸</option>
                        <option value="firstsec">ç¬¬ä¸€é‡‘è­‰åˆ¸</option>
                        <option value="sunnybank">é™½ä¿¡è­‰åˆ¸</option>
                        <option value="esun">ç‰å±±è­‰åˆ¸</option>
                        <option value="kgi">å‡±åŸºè­‰åˆ¸</option>
                        <option value="yuanta">å…ƒå¤§è­‰åˆ¸</option>
                        <option value="cathaysec">åœ‹æ³°è­‰åˆ¸</option>
                        <option value="capital">ç¾¤ç›Šè­‰åˆ¸</option>
                        <option value="masterlink">å…ƒå¯Œè­‰åˆ¸</option>
                        <option value="entrust">è¯å—æ°¸æ˜Œè­‰åˆ¸</option>
                        <option value="custom">ğŸ”§ è‡ªé¸æŠ˜æ•¸</option>
                    </select>
                </div>
                
                <div class="form-group" id="customDiscountGroup" style="display: none;">
                    <label for="customDiscount">è‡ªè¨‚æ‰‹çºŒè²»æŠ˜æ•¸</label>
                    <div class="price-group">
                        <div>
                            <label style="font-size: 0.9em; margin-bottom: 5px;">æŠ˜æ•¸ (ä¾‹ï¼š6æŠ˜å¡«6)</label>
                            <input type="number" id="customDiscount" step="0.1" min="0.1" max="10" placeholder="è«‹è¼¸å…¥æŠ˜æ•¸">
                        </div>
                        <div>
                            <label style="font-size: 0.9em; margin-bottom: 5px;">é›¶è‚¡æœ€ä½æ‰‹çºŒè²» (å…ƒ)</label>
                            <input type="number" id="customMinFee" step="1" min="1" max="50" placeholder="é è¨­1å…ƒ" value="1">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>è‚¡ç¥¨åƒ¹æ ¼ <span style="font-size: 0.9em; color: #666;">(è‡³å°‘å¡«ä¸€)</span></label>
                    <div class="price-group">
                        <div class="price-input-container">
                            <label for="buyPrice" style="font-size: 0.9em; margin-bottom: 5px;">è²·é€²åƒ¹æ ¼ (å…ƒ)</label>
                            <input type="number" id="buyPrice" step="0.01" min="0" placeholder="è²·é€²åƒ¹æ ¼">
                        </div>
                        <div class="price-input-container">
                            <label for="sellPrice" style="font-size: 0.9em; margin-bottom: 5px;">è³£å‡ºåƒ¹æ ¼ (å…ƒ)</label>
                            <input type="number" id="sellPrice" step="0.01" min="0" placeholder="è³£å‡ºåƒ¹æ ¼">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>äº¤æ˜“é¡å‹ <span class="required">*å¿…é¸</span></label>
                    <div class="stock-type-group">
                        <div class="radio-group">
                            <input type="radio" id="lot" name="stockType" value="lot" required>
                            <label for="lot">æ•´å¼µäº¤æ˜“</label>
                        </div>
                        <div class="radio-group">
                            <input type="radio" id="odd" name="stockType" value="odd" required>
                            <label for="odd">é›¶è‚¡äº¤æ˜“</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="quantity" id="quantityLabel">æ•¸é‡ <span class="required">*å¿…é¸</span></label>
                    <input type="number" id="quantity" min="1" placeholder="è«‹è¼¸å…¥æ•¸é‡ (é è¨­ç‚º1)" value="1">
                </div>
                
                <button type="submit" class="calculate-btn">ğŸ’° è¨ˆç®—äº¤æ˜“æˆæœ¬èˆ‡ç²åˆ©</button>
            </form>
            
            <div id="results" class="results">
                <div class="result-section buy-section" id="buySection" style="display: none;">
                    <h3>ğŸŸ¢ è²·å…¥æˆæœ¬</h3>
                    <div class="result-item">
                        <span>è‚¡ç¥¨é‡‘é¡ï¼š</span>
                        <span id="buyStockAmount"></span>
                    </div>
                    <div class="result-item">
                        <span>æ‰‹çºŒè²» (0.1425%)<span id="buyBrokerDiscount"></span>ï¼š</span>
                        <span id="buyCommission"></span>
                    </div>
                    <div class="result-item">
                        <span>ç¸½è²·å…¥æˆæœ¬ï¼š</span>
                        <span id="totalBuyCost"></span>
                    </div>
                </div>
                <div class="result-section sell-section" id="sellSection" style="display: none;">
                    <h3>ğŸ”´ è³£å‡ºæ”¶ç›Š</h3>
                    <div class="result-item">
                        <span>è‚¡ç¥¨é‡‘é¡ï¼š</span>
                        <span id="sellStockAmount"></span>
                    </div>
                    <div class="result-item">
                        <span>æ‰‹çºŒè²» (0.1425%)<span id="sellBrokerDiscount"></span>ï¼š</span>
                        <span id="sellCommission"></span>
                    </div>
                    <div class="result-item">
                        <span>è­‰åˆ¸äº¤æ˜“ç¨… (0.3%)ï¼š</span>
                        <span id="tax"></span>
                    </div>
                    <div class="result-item">
                        <span>æ·¨è³£å‡ºæ”¶ç›Šï¼š</span>
                        <span id="netSellProceeds"></span>
                    </div>
                </div>
                <div class="result-section profit-section" id="profitSection" style="display: none;">
                    <h3>ğŸ“Š æç›Šåˆ†æ</h3>
                    <div class="result-item">
                        <span>ç¸½äº¤æ˜“è²»ç”¨ (æŠ˜æ‰£å¾Œ)ï¼š</span>
                        <span id="totalCosts"></span>
                    </div>
                     <div class="result-item">
                        <span>æ‰‹çºŒè²»æŠ˜æ‰£å„ªæƒ ï¼š</span>
                        <span id="discountAmount"></span>
                    </div>
                    <div class="result-item">
                        <span>è©¦ç®—æç›Šï¼š</span>
                        <span id="profitAmount"></span>
                    </div>
                    <div class="result-item">
                        <span>å ±é…¬ç‡ï¼š</span>
                        <span id="profitRate"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-note">
            âš ï¸ è¨»ï¼šäº¤æ˜“æœ‰è³ºæœ‰è³ ï¼Œè«‹å°å¿ƒäº¤æ˜“ã€‚æ‰€æœ‰è¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒã€‚
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- DOM å…ƒç´ åƒç…§ ---
            const form = document.getElementById('stockCalculator');
            const brokerSelect = document.getElementById('broker');
            const customDiscountGroup = document.getElementById('customDiscountGroup');
            const customDiscountInput = document.getElementById('customDiscount');
            const customMinFeeInput = document.getElementById('customMinFee');
            const quantityInput = document.getElementById('quantity');
            const quantityLabel = document.getElementById('quantityLabel');
            const resultsDiv = document.getElementById('results');
            const radioGroups = document.querySelectorAll('.radio-group');
            
            const menuBtn = document.getElementById('menuBtn');
            const sideMenu = document.getElementById('sideMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            const menuItems = document.querySelectorAll('.menu-item');

            // --- é¸å–®æ§åˆ¶å‡½å¼ ---
            function toggleMenu() {
                sideMenu.classList.toggle('open');
                menuOverlay.classList.toggle('active');
            }
            
            function selectMenuItem(selectedItem) {
                if (selectedItem.classList.contains('disabled')) return;
                menuItems.forEach(item => item.classList.remove('active'));
                selectedItem.classList.add('active');
                closeMenu();
            }

            // --- è¨ˆç®—å™¨è¼”åŠ©å‡½å¼ ---
            function formatNumber(num) {
                if (typeof num !== 'number') return num;
                return num.toLocaleString('en-US');
            }

            // --- UI äº’å‹•å‡½å¼ ---
            function selectStockType(type) {
                radioGroups.forEach(group => group.classList.remove('active'));
                
                const selectedRadio = document.getElementById(type);
                if (selectedRadio) {
                    selectedRadio.checked = true;
                    const parentGroup = selectedRadio.closest('.radio-group');
                    if(parentGroup) parentGroup.classList.add('active');
                    
                    if (type === 'lot') {
                        quantityLabel.innerHTML = 'å¼µæ•¸ <span class="required">*å¿…é¸</span>';
                        quantityInput.placeholder = 'è«‹è¼¸å…¥å¼µæ•¸ (é è¨­ç‚º1)';
                    } else {
                        quantityLabel.innerHTML = 'è‚¡æ•¸ <span class="required">*å¿…é¸</span>';
                        quantityInput.placeholder = 'è«‹è¼¸å…¥è‚¡æ•¸ (é è¨­ç‚º1)';
                    }
                }
            }

            function handleBrokerChange() {
                customDiscountGroup.style.display = (brokerSelect.value === 'custom') ? 'block' : 'none';
                customDiscountInput.required = (brokerSelect.value === 'custom');
            }

            // --- æ ¸å¿ƒè¨ˆç®—é‚è¼¯ ---
            function getBrokerInfo(broker, stockAmount) {
                let info = { discountRate: 0.6, name: 'åˆ¸å•†', minFeeRegular: 20, minFeeOdd: 1 };
                switch (broker) {
                    case 'fubon': info = { ...info, discountRate: stockAmount >= 1000000 ? 0.6 : 0.18, name: 'å¯Œé‚¦' }; break;
                    case 'shinko': info = { ...info, discountRate: 0.1, name: 'æ–°å…‰' }; break;
                    case 'president': info = { ...info, discountRate: 0.168, name: 'çµ±ä¸€', minFeeRegular: 1 }; break;
                    case 'sinopac': info = { ...info, discountRate: 0.28, name: 'æ°¸è±' }; break; 
                    case 'pocketsec': info = { ...info, discountRate: 0.28, name: 'å£è¢‹' }; break; 
                    case 'kgi': info = { ...info, discountRate: 0.6, name: 'å‡±åŸº' }; break; 
                    case 'yuanta': info = { ...info, discountRate: 0.6, name: 'å…ƒå¤§' }; break; 
                    case 'custom':
                        const customDiscount = parseFloat(customDiscountInput.value);
                        const customMinFee = parseInt(customMinFeeInput.value) || 1;
                        info = { discountRate: customDiscount / 10, name: `è‡ªé¸${customDiscount}æŠ˜`, minFeeRegular: 20, minFeeOdd: customMinFee };
                        break;
                    default: 
                        const selectedOption = brokerSelect.querySelector(`option[value="${broker}"]`);
                        if(selectedOption) info.name = selectedOption.textContent.replace('è­‰åˆ¸', '');
                        break;
                }
                return info;
            }

            function calculateCommission(stockAmount, brokerInfo, stockType) {
                const minFee = stockType === 'lot' ? brokerInfo.minFeeRegular : brokerInfo.minFeeOdd;
                const calculatedFee = stockAmount * 0.001425 * brokerInfo.discountRate;
                return Math.max(minFee, Math.round(calculatedFee));
            }
            
            function updateResultsUI(data) {
                const {
                    buyStockAmount, sellStockAmount,
                    buyCommission, sellCommission, tax,
                    totalBuyCost, netSellProceeds,
                    profitAmount, profitRate,
                    buyBrokerInfo, sellBrokerInfo, // åŒ…å«åˆ¸å•†è³‡è¨Š
                    buyCommissionOriginal, sellCommissionOriginal, // åŸå§‹æ‰‹çºŒè²»
                    hasBuy, hasSell
                } = data;
                
                const buySection = document.getElementById('buySection');
                if (hasBuy) {
                    document.getElementById('buyStockAmount').textContent = `NT$ ${formatNumber(buyStockAmount)}`;
                    document.getElementById('buyBrokerDiscount').textContent = ``; 
                    // â­ ä¿®æ”¹ï¼šé¡¯ç¤ºæœªæŠ˜æ‰£çš„æ‰‹çºŒè²»
                    document.getElementById('buyCommission').textContent = `NT$ ${formatNumber(buyCommissionOriginal)}`;
                    document.getElementById('totalBuyCost').textContent = `NT$ ${formatNumber(totalBuyCost)}`;
                    buySection.style.display = 'block';
                } else {
                    buySection.style.display = 'none';
                }

                const sellSection = document.getElementById('sellSection');
                if (hasSell) {
                    document.getElementById('sellStockAmount').textContent = `NT$ ${formatNumber(sellStockAmount)}`;
                    document.getElementById('sellBrokerDiscount').textContent = ``; 
                    // â­ ä¿®æ”¹ï¼šé¡¯ç¤ºæœªæŠ˜æ‰£çš„æ‰‹çºŒè²»
                    document.getElementById('sellCommission').textContent = `NT$ ${formatNumber(sellCommissionOriginal)}`;
                    document.getElementById('tax').textContent = `NT$ ${formatNumber(tax)}`;
                    document.getElementById('netSellProceeds').textContent = `NT$ ${formatNumber(netSellProceeds)}`;
                    sellSection.style.display = 'block';
                } else {
                    sellSection.style.display = 'none';
                }

                const profitSection = document.getElementById('profitSection');
                if (hasBuy && hasSell) {
                    const totalCosts = buyCommission + sellCommission + tax;
                    const discountAmount = Math.max(0, (buyCommissionOriginal + sellCommissionOriginal) - (buyCommission + sellCommission));
                    
                    document.getElementById('totalCosts').textContent = `NT$ ${formatNumber(totalCosts)}`;
                    document.getElementById('discountAmount').textContent = `NT$ ${formatNumber(discountAmount)}`;

                    const profitAmountSpan = document.getElementById('profitAmount');
                    profitAmountSpan.textContent = `NT$ ${formatNumber(profitAmount)}`;
                    profitAmountSpan.className = profitAmount > 0 ? 'profit-positive' : (profitAmount < 0 ? 'profit-negative' : 'profit-zero');
                    
                    const profitRateSpan = document.getElementById('profitRate');
                    profitRateSpan.textContent = `${profitRate.toFixed(2)}%`;
                    profitRateSpan.className = profitRate > 0 ? 'profit-positive' : (profitRate < 0 ? 'profit-negative' : 'profit-zero');
                    
                    profitSection.style.display = 'block';
                } else {
                    profitSection.style.display = 'none';
                }
                
                resultsDiv.style.display = 'block';
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            }

            // --- è¡¨å–®æäº¤è™•ç† ---
            function handleFormSubmit(event) {
                event.preventDefault();
                const broker = brokerSelect.value;
                const buyPrice = parseFloat(document.getElementById('buyPrice').value) || null;
                const sellPrice = parseFloat(document.getElementById('sellPrice').value) || null;
                const stockTypeElement = document.querySelector('input[name="stockType"]:checked');
                let quantity = parseInt(quantityInput.value) || 1;

                if (!broker || !stockTypeElement || (!buyPrice && !sellPrice)) {
                    alert('è«‹æª¢æŸ¥åˆ¸å•†ã€äº¤æ˜“é¡å‹åŠåƒ¹æ ¼æ˜¯å¦éƒ½å·²æ­£ç¢ºå¡«å¯«ï¼');
                    return;
                }
                if (broker === 'custom' && (!customDiscountInput.value || parseFloat(customDiscountInput.value) <= 0 || parseFloat(customDiscountInput.value) > 10)) {
                    return alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è‡ªè¨‚æŠ˜æ•¸ (0.1-10)ï¼');
                }

                const stockType = stockTypeElement.value;
                const sharesPerUnit = stockType === 'lot' ? 1000 : 1;

                let buyStockAmount = null, sellStockAmount = null;
                let buyCommission = null, sellCommission = null;
                let buyCommissionOriginal = null, sellCommissionOriginal = null;
                let tax = null, totalBuyCost = null, netSellProceeds = null;
                let buyBrokerInfo = {}, sellBrokerInfo = {};

                if (buyPrice) {
                    buyStockAmount = buyPrice * quantity * sharesPerUnit;
                    buyBrokerInfo = getBrokerInfo(broker, buyStockAmount);
                    // â­ ä¿®æ”¹ï¼šåŒæ™‚è¨ˆç®—åŸå§‹èˆ‡æŠ˜æ‰£å¾Œæ‰‹çºŒè²»
                    buyCommissionOriginal = Math.round(buyStockAmount * 0.001425);
                    buyCommission = calculateCommission(buyStockAmount, buyBrokerInfo, stockType);
                    totalBuyCost = buyStockAmount + buyCommission;
                }

                if (sellPrice) {
                    sellStockAmount = sellPrice * quantity * sharesPerUnit;
                    sellBrokerInfo = getBrokerInfo(broker, sellStockAmount);
                    // â­ ä¿®æ”¹ï¼šåŒæ™‚è¨ˆç®—åŸå§‹èˆ‡æŠ˜æ‰£å¾Œæ‰‹çºŒè²»
                    sellCommissionOriginal = Math.round(sellStockAmount * 0.001425);
                    sellCommission = calculateCommission(sellStockAmount, sellBrokerInfo, stockType);
                    tax = Math.round(sellStockAmount * 0.003);
                    netSellProceeds = sellStockAmount - sellCommission - tax;
                }
                
                let profitAmount = null, profitRate = null;
                if (totalBuyCost !== null && netSellProceeds !== null) {
                    profitAmount = netSellProceeds - totalBuyCost;
                    profitRate = totalBuyCost > 0 ? (profitAmount / totalBuyCost) * 100 : 0;
                }

                updateResultsUI({
                    buyStockAmount: Math.round(buyStockAmount || 0),
                    sellStockAmount: Math.round(sellStockAmount || 0),
                    buyCommission: buyCommission,
                    sellCommission: sellCommission,
                    buyCommissionOriginal: buyCommissionOriginal,
                    sellCommissionOriginal: sellCommissionOriginal,
                    tax: tax,
                    totalBuyCost: Math.round(totalBuyCost || 0),
                    netSellProceeds: Math.round(netSellProceeds || 0),
                    profitAmount: Math.round(profitAmount || 0),
                    profitRate: profitRate,
                    buyBrokerInfo: buyBrokerInfo,
                    sellBrokerInfo: sellBrokerInfo,
                    hasBuy: buyPrice !== null,
                    hasSell: sellPrice !== null
                });
            }

            // --- äº‹ä»¶ç›£è½å™¨åˆå§‹åŒ– ---
            function initializeEventListeners() {
                form.addEventListener('submit', handleFormSubmit);
                brokerSelect.addEventListener('change', handleBrokerChange);
                
                radioGroups.forEach(group => {
                    group.addEventListener('click', function () {
                        const radioInput = this.querySelector('input[type="radio"]');
                        if (radioInput) selectStockType(radioInput.id);
                    });
                });
                
                menuBtn.addEventListener('click', toggleMenu);
                menuOverlay.addEventListener('click', closeMenu);

                menuItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        selectMenuItem(this);
                    });
                });
            }

            // --- ç¨‹å¼é€²å…¥é» ---
            initializeEventListeners();
        });
    </script>
</body>
</html>
