<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡äº¤æ˜“é‡‘é¡è¨ˆç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', 'Arial', sans-serif;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 50%, rgba(231, 76, 60, 0.8) 100%);
        min-height: 100vh;
        padding: 20px;
        position: relative;
    }

    /* èƒŒæ™¯æŸ”åŒ–æ•ˆæœ */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, 
            rgba(102, 126, 234, 0.6) 0%, 
            rgba(118, 75, 162, 0.6) 25%,
            rgba(155, 89, 182, 0.5) 50%,
            rgba(231, 76, 60, 0.6) 75%,
            rgba(236, 112, 99, 0.5) 100%);
        backdrop-filter: blur(1px);
        -webkit-backdrop-filter: blur(1px);
        z-index: -1;
    }

    .container {
        max-width: 700px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
        z-index: 1;
    }

    /* åº•éƒ¨è¨»è¨˜ */
    .footer-note {
        background: rgba(44, 62, 80, 0.9);
        color: white;
        text-align: center;
        padding: 15px;
        font-size: 0.9em;
        border-radius: 0 0 20px 20px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    .menu-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        color: #2c3e50;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        z-index: 1000;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .menu-btn:hover {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.05);
    }

    /* å´é‚Šé¸å–® */
    .side-menu {
        position: fixed;
        top: 0;
        left: -300px;
        width: 280px;
        height: 100vh;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-right: 1px solid rgba(255, 255, 255, 0.2);
        transition: left 0.3s ease;
        z-index: 999;
        padding: 80px 0 20px 0;
        box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
    }

    .side-menu.open {
        left: 0;
    }

    .menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 998;
    }

    .menu-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .menu-item {
        display: block;
        padding: 20px 30px;
        color: white;
        text-decoration: none;
        font-size: 1.1em;
        font-weight: 500;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
        padding-left: 40px;
    }

    .menu-item.active {
        background: rgba(255, 255, 255, 0.2);
        border-left: 4px solid #3498db;
    }

    .menu-item.disabled {
        color: rgba(255, 255, 255, 0.5);
        cursor: not-allowed;
    }

    .menu-item.disabled:hover {
        background: none;
        padding-left: 30px;
    }

    .menu-title {
        padding: 0 30px 20px 30px;
        color: white;
        font-size: 1.3em;
        font-weight: bold;
        border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        margin-bottom: 10px;
    }

    .header {
        background: linear-gradient(135deg, #2c3e50, #3498db, #e74c3c);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 2em;
        margin-bottom: 10px;
    }

    .header p {
        opacity: 0.9;
        font-size: 1.1em;
    }

    .form-container {
        padding: 30px;
    }

    .info-box {
        background: #e8f4fd;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #3498db;
    }

    .info-box h4 {
        margin: 0 0 10px 0;
        color: #2c3e50;
        font-family: inherit;
    }

    .info-box .tick-info {
        font-size: 0.9em;
        color: #555;
        font-family: inherit;
    }

    .form-group {
        margin-bottom: 25px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
        font-size: 1.1em;
        font-family: inherit;
    }

    .required {
        color: #e74c3c;
        font-family: inherit;
    }

    select, input {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1em;
        transition: all 0.3s ease;
        font-family: inherit;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    input[type="number"] {
        -webkit-appearance: none;
        -moz-appearance: textfield;
        appearance: none;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    select:focus, input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    /* iOS Safari ç‰¹æ®Šè™•ç† */
    @supports (-webkit-touch-callout: none) {
        select, input {
            font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
        }
    }

    .price-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .price-input-container {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .stock-type-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .radio-group {
        display: flex;
        align-items: center;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }

    .radio-group:hover {
        border-color: #3498db;
        background-color: #f8f9fa;
    }

    .radio-group input[type="radio"] {
        width: auto;
        margin-right: 10px;
        transform: scale(1.2);
    }

    .radio-group.active {
        border-color: #3498db;
        background-color: #e3f2fd;
    }

    .radio-group label {
        margin: 0;
        cursor: pointer;
        font-weight: normal;
    }

    .calculate-btn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #3498db 0%, #e74c3c 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 20px;
        font-family: inherit;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        background: linear-gradient(135deg, #2980b9 0%, #c0392b 100%);
    }

    .calculate-btn:active {
        transform: translateY(0);
    }

    .results {
        display: none;
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-top: 20px;
    }

    .result-section {
        margin-bottom: 20px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .result-section h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.3em;
        font-family: inherit;
    }

    .result-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
        font-family: inherit;
    }

    .result-item:last-child {
        border-bottom: none;
        font-weight: bold;
        font-size: 1.1em;
    }

    .buy-section {
        border-left: 4px solid #27ae60;
    }

    .buy-section .result-item:last-child {
        color: #27ae60;
    }

    .sell-section {
        border-left: 4px solid #e74c3c;
    }

    .sell-section .result-item:last-child {
        color: #e74c3c;
    }

    .profit-section {
        border-left: 4px solid #f39c12;
    }

    .profit-positive {
        color: #27ae60;
        font-weight: bold;
    }

    .profit-negative {
        color: #e74c3c;
        font-weight: bold;
    }

    .profit-zero {
        color: #7f8c8d;
        font-weight: bold;
    }

    @media (max-width: 768px) {
        .container {
            margin: 10px;
            border-radius: 15px;
        }

        .header {
            padding: 20px;
        }

        .header h1 {
            font-size: 1.6em;
        }

        .form-container {
            padding: 20px;
        }

        .price-group,
        .stock-type-group {
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .calculate-btn {
            font-size: 1.1em;
            padding: 16px;
        }

        .result-item {
            font-size: 0.95em;
        }

        .menu-btn {
            width: 45px;
            height: 45px;
            top: 15px;
            left: 15px;
        }

        .side-menu {
            width: 250px;
            left: -250px;
        }
    }

    @media (max-width: 480px) {
        body {
            padding: 5px;
        }

        .header h1 {
            font-size: 1.4em;
        }

        .form-container {
            padding: 15px;
        }

        .info-box {
            padding: 12px;
        }

        .info-box table {
            font-size: 0.85em;
        }

        .info-box th,
        .info-box td {
            padding: 6px !important;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .result-section {
            padding: 15px;
        }

        .result-item {
            font-size: 0.9em;
            padding: 6px 0;
        }

        .menu-btn {
            width: 40px;
            height: 40px;
            top: 10px;
            left: 10px;
            font-size: 1.3em;
        }

        .side-menu {
            width: 220px;
            left: -220px;
        }

        .footer-note {
            font-size: 0.8em;
            padding: 12px;
        }
    }

    /* è¶…å°è¢å¹•å„ªåŒ– */
    @media (max-width: 360px) {
        .header h1 {
            font-size: 1.2em;
        }

        .form-container {
            padding: 10px;
        }

        .info-box table {
            font-size: 0.8em;
        }

        .calculate-btn {
            font-size: 1em;
            padding: 14px;
        }

        .side-menu {
            width: 200px;
            left: -200px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <!-- åŠŸèƒ½è¡¨æŒ‰éˆ• -->
        <button class="menu-btn" onclick="toggleMenu()">â˜°</button>

```
    <!-- å´é‚Šé¸å–® -->
    <div class="menu-overlay" onclick="closeMenu()"></div>
    <nav class="side-menu" id="sideMenu">
        <div class="menu-title">ğŸ“Š äº¤æ˜“è¨ˆç®—å™¨</div>
        <a href="#" class="menu-item active" onclick="selectMenuItem(this, 'taiwan')">
            å°è‚¡äº¤æ˜“
        </a>
        <a href="#" class="menu-item disabled" onclick="selectMenuItem(this, 'foreign')">
            è¤‡å§”è¨—äº¤æ˜“ <span style="font-size: 0.8em; color: rgba(255,255,255,0.6);">(é–‹ç™¼ä¸­)</span>
        </a>
    </nav>
    <div class="header">
        <h1>ğŸ“ˆ å°è‚¡äº¤æ˜“è¨ˆç®—å™¨</h1>
        <p>ç²¾æº–è¨ˆç®—æ‚¨çš„è‚¡ç¥¨äº¤æ˜“æˆæœ¬èˆ‡æç›Š</p>
    </div>

    <div class="form-container">
        <!-- åƒ¹æ ¼è·³å‹•å–®ä½èªªæ˜è¡¨æ ¼ -->
        <div class="info-box">
            <h4>ğŸ“Š å°è‚¡åƒ¹æ ¼è·³å‹•å–®ä½åƒè€ƒè¡¨</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">è‚¡åƒ¹å€é–“</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">è·³å‹•å–®ä½</th>
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">ç¯„ä¾‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">10å…ƒä»¥ä¸‹</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.01å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">9.98, 9.99, 10.00</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">10å…ƒ~æœªæ»¿50å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.05å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">10.00, 10.05, 10.10...49.95</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">50å…ƒ~æœªæ»¿100å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.1å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">50.0, 50.1, 50.2...99.9, 100.0</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">100å…ƒ~æœªæ»¿500å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">0.5å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">100.0, 100.5, 101.0...499.5, 500.0</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">500å…ƒ~æœªæ»¿1000å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">1å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">500, 501, 502...999, 1000</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">1000å…ƒä»¥ä¸Š</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">5å…ƒ</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">1000, 1005, 1010, 1015...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <form id="stockCalculator">
            <!-- åˆ¸å•†é¸æ“‡ -->
            <div class="form-group">
                <label for="broker">åˆ¸å•†é¸æ“‡</label>
                <select id="broker" required>
                    <option value="">è«‹é¸æ“‡åˆ¸å•†</option>
                    <option value="fubon">å¯Œé‚¦è­‰åˆ¸</option>
                    <option value="shinko">æ–°å…‰è­‰åˆ¸</option>
                    <option value="president">çµ±ä¸€è­‰åˆ¸</option>
                    <option value="sinopac">æ°¸è±è­‰åˆ¸</option>
                    <option value="taishin">å°æ–°è­‰åˆ¸</option>
                    <option value="pocketsec">å£è¢‹è­‰åˆ¸</option>
                    <option value="landbank">åœŸéŠ€è­‰åˆ¸</option>
                    <option value="bot">è‡ºéŠ€è­‰åˆ¸</option>
                    <option value="megasec">å…†è±è­‰åˆ¸</option>
                    <option value="tcbsec">åˆåº«è­‰åˆ¸</option>
                    <option value="changhuasec">å½°éŠ€è­‰åˆ¸</option>
                    <option value="ctbc">ä¸­åœ‹ä¿¡è¨—è­‰åˆ¸</option>
                    <option value="firstsec">ç¬¬ä¸€é‡‘è­‰åˆ¸</option>
                    <option value="sunnybank">é™½ä¿¡è­‰åˆ¸</option>
                    <option value="esun">ç‰å±±è­‰åˆ¸</option>
                    <option value="kgi">å‡±åŸºè­‰åˆ¸</option>
                    <option value="yuanta">å…ƒå¤§è­‰åˆ¸</option>
                    <option value="cathaysec">åœ‹æ³°è­‰åˆ¸</option>
                    <option value="capital">ç¾¤ç›Šè­‰åˆ¸</option>
                    <option value="masterlink">å…ƒå¯Œè­‰åˆ¸</option>
                    <option value="entrust">è¯å—æ°¸æ˜Œè­‰åˆ¸</option>
                    <option value="custom">ğŸ”§ è‡ªé¸æŠ˜æ•¸</option>
                </select>
            </div>

            <!-- è‡ªé¸æŠ˜æ•¸è¼¸å…¥å€ -->
            <div class="form-group" id="customDiscountGroup" style="display: none;">
                <label for="customDiscount">è‡ªè¨‚æ‰‹çºŒè²»æŠ˜æ•¸</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="font-size: 0.9em; margin-bottom: 5px;">æŠ˜æ•¸ (ä¾‹å¦‚ï¼š6æŠ˜è¼¸å…¥6)</label>
                        <input type="number" id="customDiscount" step="0.1" min="0.1" max="10" placeholder="è«‹è¼¸å…¥æŠ˜æ•¸">
                    </div>
                    <div>
                        <label style="font-size: 0.9em; margin-bottom: 5px;">é›¶è‚¡æœ€ä½æ‰‹çºŒè²» (å…ƒ)</label>
                        <input type="number" id="customMinFee" step="1" min="1" max="50" placeholder="é è¨­1å…ƒ" value="1">
                    </div>
                </div>
            </div>

            <!-- è‚¡ç¥¨åƒ¹æ ¼ -->
            <div class="form-group">
                <label>è‚¡ç¥¨åƒ¹æ ¼ <span style="color: #e74c3c; font-size: 0.9em;">*è‡³å°‘å¡«å…¥ä¸€å€‹</span></label>
                <div class="price-group">
                    <div class="price-input-container">
                        <label for="buyPrice" style="font-size: 0.9em; margin-bottom: 5px;">
                            è²·é€²åƒ¹æ ¼ (å…ƒ) <span style="color: #666; font-size: 0.8em;">é¸å¡«</span>
                        </label>
                        <input type="number" id="buyPrice" step="0.01" min="0" placeholder="è²·é€²åƒ¹æ ¼">
                    </div>
                    <div class="price-input-container">
                        <label for="sellPrice" style="font-size: 0.9em; margin-bottom: 5px;">
                            è³£å‡ºåƒ¹æ ¼ (å…ƒ) <span style="color: #666; font-size: 0.8em;">é¸å¡«</span>
                        </label>
                        <input type="number" id="sellPrice" step="0.01" min="0" placeholder="è³£å‡ºåƒ¹æ ¼">
                    </div>
                </div>
            </div>

            <!-- äº¤æ˜“é¡å‹ -->
            <div class="form-group">
                <label>äº¤æ˜“é¡å‹ <span class="required">*å¿…é¸</span></label>
                <div class="stock-type-group">
                    <div class="radio-group" onclick="selectStockType('lot', this)">
                        <input type="radio" id="lot" name="stockType" value="lot" required>
                        <label for="lot" style="margin: 0; cursor: pointer;">æ•´å¼µäº¤æ˜“</label>
                    </div>
                    <div class="radio-group" onclick="selectStockType('odd', this)">
                        <input type="radio" id="odd" name="stockType" value="odd" required>
                        <label for="odd" style="margin: 0; cursor: pointer;">é›¶è‚¡äº¤æ˜“</label>
                    </div>
                </div>
            </div>

            <!-- æ•¸é‡ -->
            <div class="form-group">
                <label for="quantity" id="quantityLabel">æ•¸é‡ <span class="required">*å¿…é¸</span></label>
                <input type="number" id="quantity" min="1" placeholder="è«‹è¼¸å…¥æ•¸é‡ (é è¨­ç‚º1)" value="1">
            </div>

            <button type="submit" class="calculate-btn">ğŸ’° è¨ˆç®—äº¤æ˜“æˆæœ¬èˆ‡æç›Š</button>
        </form>

        <!-- è¨ˆç®—çµæœ -->
        <div id="results" class="results">
            <!-- çµæœæœƒå‹•æ…‹æ’å…¥åˆ°é€™è£¡ -->
        </div>
    </div>

    <!-- åº•éƒ¨è¨»è¨˜ -->
    <div class="footer-note">
        âš ï¸ è¨»ï¼šäº¤æ˜“æœ‰è³ºæœ‰è³ ï¼Œè«‹å°å¿ƒäº¤æ˜“ã€‚
    </div>
</div>

<script>
    // ç­‰å¾…DOMè¼‰å…¥å®Œæˆ
    document.addEventListener('DOMContentLoaded', function() {
        initializeEventListeners();
    });

    // åŠŸèƒ½è¡¨æ§åˆ¶
    function toggleMenu() {
        const sideMenu = document.getElementById('sideMenu');
        const overlay = document.querySelector('.menu-overlay');
        
        if (sideMenu.classList.contains('open')) {
            closeMenu();
        } else {
            sideMenu.classList.add('open');
            overlay.classList.add('active');
        }
    }

    function closeMenu() {
        const sideMenu = document.getElementById('sideMenu');
        const overlay = document.querySelector('.menu-overlay');
        
        sideMenu.classList.remove('open');
        overlay.classList.remove('active');
    }

    function selectMenuItem(element, type) {
        if (element.classList.contains('disabled')) {
            return; // ä¸å…è¨±é»æ“Šé–‹ç™¼ä¸­çš„é …ç›®
        }
        
        // ç§»é™¤æ‰€æœ‰ active ç‹€æ…‹
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // æ·»åŠ  active ç‹€æ…‹åˆ°ç•¶å‰é …ç›®
        element.classList.add('active');
        
        // é—œé–‰é¸å–®
        closeMenu();
        
        // é€™è£¡å¯ä»¥æ ¹æ“š type åˆ‡æ›ä¸åŒé é¢
        if (type === 'taiwan') {
            // ç•¶å‰å°±æ˜¯å°è‚¡é é¢ï¼Œä¸éœ€è¦åšä»»ä½•äº‹
            console.log('åˆ‡æ›åˆ°å°è‚¡äº¤æ˜“é é¢');
        } else if (type === 'foreign') {
            // è¤‡å§”è¨—é é¢ï¼ˆé–‹ç™¼ä¸­ï¼‰
            console.log('è¤‡å§”è¨—äº¤æ˜“é é¢é–‹ç™¼ä¸­');
        }
    }

    // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
    function initializeEventListeners() {
        // è¡¨å–®æäº¤
        document.getElementById('stockCalculator').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('è¡¨å–®æäº¤äº‹ä»¶è§¸ç™¼'); // èª¿è©¦ç”¨
            calculateTradingCost();
        });

        // åˆ¸å•†é¸æ“‡è®ŠåŒ–
        document.getElementById('broker').addEventListener('change', function() {
            handleBrokerChange(this.value);
        });

        // äº¤æ˜“é¡å‹é¸æ“‡ - ç›´æ¥ç›£è½ radio button
        document.querySelectorAll('input[name="stockType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                console.log('Radio button æ”¹è®Š:', this.value); // èª¿è©¦ç”¨
                if (this.checked) {
                    selectStockType(this.value, this.parentElement);
                }
            });
        });

        // æ¸¬è©¦æŒ‰éˆ•é»æ“Š
        document.querySelector('.calculate-btn').addEventListener('click', function(e) {
            console.log('è¨ˆç®—æŒ‰éˆ•è¢«é»æ“Š'); // èª¿è©¦ç”¨
        });
    }

    // è™•ç†åˆ¸å•†é¸æ“‡è®ŠåŒ–
    function handleBrokerChange(brokerValue) {
        const customDiscountGroup = document.getElementById('customDiscountGroup');
        
        if (brokerValue === 'custom') {
            customDiscountGroup.style.display = 'block';
            document.getElementById('customDiscount').required = true;
        } else {
            customDiscountGroup.style.display = 'none';
            document.getElementById('customDiscount').required = false;
            // æ¸…ç©ºè‡ªè¨‚å€¼
            document.getElementById('customDiscount').value = '';
            document.getElementById('customMinFee').value = '1';
        }
    }

    // ç²å–åƒ¹æ ¼å°æ‡‰çš„è·³å‹•å–®ä½
    function getTickSize(price) {
        if (price < 10) return 0.01;
        if (price < 50) return 0.05;
        if (price < 100) return 0.1;
        if (price < 500) return 0.5;
        if (price < 1000) return 1;
        return 5;
    }

    // é¸æ“‡äº¤æ˜“é¡å‹ - å¢åŠ è·¨å¹³å°å…¼å®¹æ€§
    function selectStockType(type, element) {
        console.log('é¸æ“‡äº¤æ˜“é¡å‹:', type); // èª¿è©¦ç”¨
        
        // ç§»é™¤æ‰€æœ‰ active class
        document.querySelectorAll('.radio-group').forEach(group => {
            group.classList.remove('active');
        });
        
        // é¸æ“‡å°æ‡‰çš„ radio button
        const selectedRadio = document.getElementById(type);
        selectedRadio.checked = true;
        element.classList.add('active');
        
        // æ›´æ–°æ•¸é‡æ¨™ç±¤
        const quantityLabel = document.getElementById('quantityLabel');
        if (type === 'lot') {
            quantityLabel.innerHTML = 'å¼µæ•¸ <span class="required">*å¿…é¸</span>';
            document.getElementById('quantity').placeholder = 'è«‹è¼¸å…¥å¼µæ•¸ (é è¨­ç‚º1)';
        } else {
            quantityLabel.innerHTML = 'è‚¡æ•¸ <span class="required">*å¿…é¸</span>';
            document.getElementById('quantity').placeholder = 'è«‹è¼¸å…¥è‚¡æ•¸ (é è¨­ç‚º1)';
        }
        
        console.log('äº¤æ˜“é¡å‹é¸æ“‡å®Œæˆ:', selectedRadio.checked); // èª¿è©¦ç”¨
    }

    // è·¨å¹³å°æ•¸å­—æ ¼å¼åŒ–
    function formatNumber(num) {
        if (typeof Intl !== 'undefined' && Intl.NumberFormat) {
            try {
                return new Intl.NumberFormat('zh-TW').format(num);
            } catch (e) {
                // é™ç´šè™•ç†
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }
        } else {
            // æ‰‹å‹•å¯¦ç¾åƒåˆ†ä½æ ¼å¼åŒ–
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
    }

    // è¨ˆç®—äº¤æ˜“æˆæœ¬
    function calculateTradingCost() {
        const broker = document.getElementById('broker').value;
        const buyPrice = parseFloat(document.getElementById('buyPrice').value);
        const sellPrice = parseFloat(document.getElementById('sellPrice').value);
        const stockTypeElement = document.querySelector('input[name="stockType"]:checked');
        let quantity = document.getElementById('quantity').value;

        // æª¢æŸ¥å¿…å¡«æ¬„ä½
        if (!broker) {
            alert('è«‹é¸æ“‡åˆ¸å•†ï¼');
            return;
        }
        
        if (!buyPrice || buyPrice <= 0) {
            alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è²·é€²åƒ¹æ ¼ï¼');
            return;
        }
        
        if (!sellPrice || sellPrice <= 0) {
            alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è³£å‡ºåƒ¹æ ¼ï¼');
            return;
        }
        
        if (!stockTypeElement) {
            alert('è«‹é¸æ“‡äº¤æ˜“é¡å‹ï¼ˆæ•´å¼µæˆ–é›¶è‚¡ï¼‰ï¼');
            return;
        }

        // æª¢æŸ¥è‡ªé¸æŠ˜æ•¸
        if (broker === 'custom') {
            const customDiscount = document.getElementById('customDiscount').value;
            if (!customDiscount || parseFloat(customDiscount) <= 0 || parseFloat(customDiscount) > 10) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æŠ˜æ•¸ (0.1-10)ï¼');
                return;
            }
        }

        // å¦‚æœæ•¸é‡ç©ºç™½ï¼Œé è¨­ç‚º1
        if (!quantity || quantity === '') {
            quantity = 1;
            document.getElementById('quantity').value = 1;
        } else {
            quantity = parseInt(quantity);
            if (quantity <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸é‡ï¼');
                return;
            }
        }

        const stockType = stockTypeElement.value;

        try {

        // è¨ˆç®—è‚¡ç¥¨ç¸½åƒ¹
        let buyStockAmount, sellStockAmount;
        if (stockType === 'lot') {
            buyStockAmount = buyPrice * quantity * 1000; // ä¸€å¼µ = 1000è‚¡
            sellStockAmount = sellPrice * quantity * 1000;
        } else {
            buyStockAmount = buyPrice * quantity;
            sellStockAmount = sellPrice * quantity;
        }

        // åˆ¸å•†æ‰‹çºŒè²»æŠ˜æ‰£è¨ˆç®—
        function getBrokerInfo(broker, stockAmount) {
            switch (broker) {
                case 'fubon':
                    // å¯Œé‚¦è­‰åˆ¸ï¼šè‚¡ç¥¨é‡‘é¡100è¬ç‚ºåˆ†ç•Œ
                    return {
                        discountRate: stockAmount >= 1000000 ? 0.6 : 0.18,
                        name: 'å¯Œé‚¦è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'shinko':
                    // æ–°å…‰è­‰åˆ¸ï¼š1æŠ˜
                    return {
                        discountRate: 0.1,
                        name: 'æ–°å…‰è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'president':
                    // çµ±ä¸€è­‰åˆ¸ï¼š1.68æŠ˜ï¼Œæœ€ä½æ‰‹çºŒè²»çµ±ä¸€ç‚º1å…ƒ
                    return {
                        discountRate: 0.168,
                        name: 'çµ±ä¸€è­‰åˆ¸',
                        minFeeRegular: 1,
                        minFeeOdd: 1
                    };
                case 'sinopac':
                    // æ°¸è±è­‰åˆ¸ï¼š2æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.2,
                        name: 'æ°¸è±è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'taishin':
                    // å°æ–°è­‰åˆ¸ï¼š2æŠ˜
                    return {
                        discountRate: 0.2,
                        name: 'å°æ–°è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'pocketsec':
                    // å£è¢‹è­‰åˆ¸ï¼š2.8æŠ˜
                    return {
                        discountRate: 0.28,
                        name: 'å£è¢‹è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'landbank':
                    // åœŸéŠ€è­‰åˆ¸ï¼š3æŠ˜
                    return {
                        discountRate: 0.3,
                        name: 'åœŸéŠ€è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'bot':
                    // è‡ºéŠ€è­‰åˆ¸ï¼š3.5æŠ˜
                    return {
                        discountRate: 0.35,
                        name: 'è‡ºéŠ€è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'megasec':
                    // å…†è±è­‰åˆ¸ï¼š5æŠ˜
                    return {
                        discountRate: 0.5,
                        name: 'å…†è±è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'tcbsec':
                    // åˆåº«è­‰åˆ¸ï¼š5æŠ˜
                    return {
                        discountRate: 0.5,
                        name: 'åˆåº«è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'changhuasec':
                    // å½°éŠ€è­‰åˆ¸ï¼š5æŠ˜
                    return {
                        discountRate: 0.5,
                        name: 'å½°éŠ€è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'ctbc':
                    // ä¸­åœ‹ä¿¡è¨—è­‰åˆ¸ï¼š6æŠ˜
                    return {
                        discountRate: 0.6,
                        name: 'ä¸­åœ‹ä¿¡è¨—è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'firstsec':
                    // ç¬¬ä¸€é‡‘è­‰åˆ¸ï¼š6æŠ˜ï¼Œé›¶è‚¡æœ€ä½2å…ƒ
                    return {
                        discountRate: 0.6,
                        name: 'ç¬¬ä¸€é‡‘è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 2
                    };
                case 'sunnybank':
                    // é™½ä¿¡è­‰åˆ¸ï¼š6æŠ˜
                    return {
                        discountRate: 0.6,
                        name: 'é™½ä¿¡è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'esun':
                    // ç‰å±±è­‰åˆ¸ï¼š6æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.6,
                        name: 'ç‰å±±è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'kgi':
                    // å‡±åŸºè­‰åˆ¸ï¼š6æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.6,
                        name: 'å‡±åŸºè­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'yuanta':
                    // å…ƒå¤§è­‰åˆ¸ï¼š6æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.6,
                        name: 'å…ƒå¤§è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'cathaysec':
                    // åœ‹æ³°è­‰åˆ¸ï¼š2.8æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.28,
                        name: 'åœ‹æ³°è­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'capital':
                    // ç¾¤ç›Šè­‰åˆ¸ï¼š6æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.6,
                        name: 'ç¾¤ç›Šè­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'masterlink':
                    // å…ƒå¯Œè­‰åˆ¸ï¼š6.5æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.65,
                        name: 'å…ƒå¯Œè­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'entrust':
                    // è¯å—æ°¸æ˜Œè­‰åˆ¸ï¼š6.5æŠ˜ï¼Œé›¶è‚¡æœ€ä½1å…ƒ
                    return {
                        discountRate: 0.65,
                        name: 'è¯å—æ°¸æ˜Œè­‰åˆ¸',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
                case 'custom':
                    // è‡ªé¸æŠ˜æ•¸
                    const customDiscount = parseFloat(document.getElementById('customDiscount').value);
                    const customMinFee = parseInt(document.getElementById('customMinFee').value) || 1;
                    
                    if (!customDiscount || customDiscount <= 0 || customDiscount > 10) {
                        throw new Error('è«‹è¼¸å…¥æœ‰æ•ˆçš„æŠ˜æ•¸ (0.1-10)');
                    }
                    
                    return {
                        discountRate: customDiscount / 10, // 6æŠ˜ = 0.6
                        name: `è‡ªé¸ ${customDiscount}æŠ˜`,
                        minFeeRegular: 20,
                        minFeeOdd: customMinFee
                    };
                default:
                    return {
                        discountRate: 1.0,
                        name: 'ä¸€èˆ¬åˆ¸å•†',
                        minFeeRegular: 20,
                        minFeeOdd: 1
                    };
            }
        }

        const buyBrokerInfo = getBrokerInfo(broker, buyStockAmount);
        const sellBrokerInfo = getBrokerInfo(broker, sellStockAmount);

        // è¨ˆç®—åŸå§‹æ‰‹çºŒè²»ï¼ˆæœªæŠ˜æ‰£ï¼‰
        let buyCommissionOriginal = buyStockAmount * 0.001425;
        let sellCommissionOriginal = sellStockAmount * 0.001425;

        // è¨ˆç®—æŠ˜æ‰£å¾Œæ‰‹çºŒè²»
        let buyCommission = buyCommissionOriginal * buyBrokerInfo.discountRate;
        let sellCommission = sellCommissionOriginal * sellBrokerInfo.discountRate;

        // æœ€ä½æ‰‹çºŒè²»è™•ç†ï¼ˆæ ¹æ“šåˆ¸å•†å’Œäº¤æ˜“é¡å‹ï¼‰
        if (stockType === 'lot') {
            // æ•´å¼µäº¤æ˜“
            if (buyCommissionOriginal < buyBrokerInfo.minFeeRegular) buyCommissionOriginal = buyBrokerInfo.minFeeRegular;
            if (sellCommissionOriginal < sellBrokerInfo.minFeeRegular) sellCommissionOriginal = sellBrokerInfo.minFeeRegular;
            if (buyCommission < buyBrokerInfo.minFeeRegular) buyCommission = buyBrokerInfo.minFeeRegular;
            if (sellCommission < sellBrokerInfo.minFeeRegular) sellCommission = sellBrokerInfo.minFeeRegular;
        } else {
            // é›¶è‚¡äº¤æ˜“
            if (buyCommissionOriginal < buyBrokerInfo.minFeeOdd) buyCommissionOriginal = buyBrokerInfo.minFeeOdd;
            if (sellCommissionOriginal < sellBrokerInfo.minFeeOdd) sellCommissionOriginal = sellBrokerInfo.minFeeOdd;
            if (buyCommission < buyBrokerInfo.minFeeOdd) buyCommission = buyBrokerInfo.minFeeOdd;
            if (sellCommission < sellBrokerInfo.minFeeOdd) sellCommission = sellBrokerInfo.minFeeOdd;
        }

        // é‡æ–°è¨ˆç®—æŠ˜æ‰£é‡‘é¡ï¼ˆå› ç‚ºå¯èƒ½æœ‰æœ€ä½æ‰‹çºŒè²»èª¿æ•´ï¼‰
        const buyDiscount = buyCommissionOriginal - buyCommission;
        const sellDiscount = sellCommissionOriginal - sellCommission;
        const totalDiscount = buyDiscount + sellDiscount;

        // è­‰åˆ¸äº¤æ˜“ç¨…ï¼ˆè³£å‡ºé‡‘é¡ Ã— 0.3%ï¼‰
        const tax = sellStockAmount * 0.003;

        // è¨ˆç®—ç¸½æˆæœ¬ï¼ˆä½¿ç”¨æœªæŠ˜æ‰£æ‰‹çºŒè²»ï¼‰
        const totalBuyCostOriginal = buyStockAmount + buyCommissionOriginal;
        const netSellProceedsOriginal = sellStockAmount - sellCommissionOriginal - tax;

        // è¨ˆç®—å¯¦éš›æˆæœ¬ï¼ˆä½¿ç”¨æŠ˜æ‰£å¾Œæ‰‹çºŒè²»ï¼‰
        const totalBuyCost = buyStockAmount + buyCommission;
        const netSellProceeds = sellStockAmount - sellCommission - tax;

        // è¨ˆç®—æç›Šï¼ˆåŸºæ–¼å¯¦éš›æŠ˜æ‰£å¾Œçš„è²»ç”¨ï¼‰
        const totalCosts = buyCommission + sellCommission + tax;
        const profitAmount = netSellProceeds - totalBuyCost;
        const profitRate = (profitAmount / totalBuyCost) * 100;

        // é¡¯ç¤ºçµæœ
        updateResults({
            buyStockAmount,
            buyCommissionOriginal,
            totalBuyCostOriginal,
            sellStockAmount,
            sellCommissionOriginal,
            tax,
            netSellProceedsOriginal,
            totalCosts,
            totalDiscount,
            profitAmount,
            profitRate,
            buyBrokerInfo,
            sellBrokerInfo
        });
        
        } catch (error) {
            alert('è¨ˆç®—éŒ¯èª¤ï¼š' + error.message);
        }
    }

    // æ›´æ–°çµæœé¡¯ç¤º - ä½¿ç”¨è·¨å¹³å°æ•¸å­—æ ¼å¼åŒ–
    function updateResults(data) {
        const resultsContainer = document.getElementById('results');
        let resultsHTML = '';

        // è²·å…¥çµæœå€å¡Š
        if (data.hasBuyPrice) {
            resultsHTML += `
                <div class="result-section buy-section">
                    <h3>ğŸŸ¢ è²·å…¥æˆæœ¬</h3>
                    <div class="result-item">
                        <span>è‚¡ç¥¨é‡‘é¡ï¼š</span>
                        <span>NT$ ${formatNumber(data.buyStockAmount)}</span>
                    </div>
                    <div class="result-item">
                        <span>æ‰‹çºŒè²» (0.1425%) ${getDiscountText(data.buyBrokerInfo)}ï¼š</span>
                        <span>NT$ ${formatNumber(Math.round(data.buyCommissionOriginal))}</span>
                    </div>
                    <div class="result-item">
                        <span>ç¸½è²·å…¥æˆæœ¬ (è©¦ç®—)ï¼š</span>
                        <span>NT$ ${formatNumber(Math.round(data.totalBuyCostOriginal))}</span>
                    </div>
                </div>
            `;
        }

        // è³£å‡ºçµæœå€å¡Š
        if (data.hasSellPrice) {
            resultsHTML += `
                <div class="result-section sell-section">
                    <h3>ğŸ”´ è³£å‡ºæ”¶ç›Š</h3>
                    <div class="result-item">
                        <span>è‚¡ç¥¨é‡‘é¡ï¼š</span>
                        <span>NT$ ${formatNumber(data.sellStockAmount)}</span>
                    </div>
                    <div class="result-item">
                        <span>æ‰‹çºŒè²» (0.1425%) ${getDiscountText(data.sellBrokerInfo)}ï¼š</span>
                        <span>NT$ ${formatNumber(Math.round(data.sellCommissionOriginal))}</span>
                    </div>
                    <div class="result-item">
                        <span>è­‰åˆ¸äº¤æ˜“ç¨… (0.3%)ï¼š</span>
                        <span>NT$ ${formatNumber(Math.round(data.tax))}</span>
                    </div>
                    <div class="result-item">
                        <span>æ·¨è³£å‡ºæ”¶ç›Š (è©¦ç®—)ï¼š</span>
                        <span>NT$ ${formatNumber(Math.round(data.netSellProceedsOriginal))}</span>
                    </div>
                </div>
            `;
        }

        // è²»ç”¨åˆ†æå€å¡Š
        resultsHTML += `
            <div class="result-section profit-section">
                <h3>ğŸ“Š è²»ç”¨åˆ†æ</h3>
                <div class="result-item">
                    <span>ç¸½äº¤æ˜“è²»ç”¨ï¼š</span>
                    <span>NT$ ${formatNumber(Math.round(data.totalCosts))}</span>
                </div>
                <div class="result-item">
                    <span>æ‰‹çºŒè²»æŠ˜æ‰£å„ªæƒ ï¼š</span>
                    <span style="color: #27ae60;">-NT$ ${formatNumber(Math.round(data.totalDiscount))}</span>
                </div>
        `;

        // åªæœ‰åœ¨è²·å…¥å’Œè³£å‡ºåƒ¹æ ¼éƒ½æœ‰æ™‚æ‰é¡¯ç¤ºæç›Š
        if (data.hasBuyPrice && data.hasSellPrice) {
            let profitClass;
            let profitAmountText, profitRateText;

            if (data.profitAmount > 0) {
                profitClass = 'profit-positive';
                profitAmountText = `+NT$ ${formatNumber(Math.round(data.profitAmount))}`;
                profitRateText = `+${data.profitRate.toFixed(2)}%`;
            } else if (data.profitAmount < 0) {
                profitClass = 'profit-negative';
                profitAmountText = `-NT$ ${formatNumber(Math.round(Math.abs(data.profitAmount)))}`;
                profitRateText = `${data.profitRate.toFixed(2)}%`;
            } else {
                profitClass = 'profit-zero';
                profitAmountText = `NT$ 0`;
                profitRateText = `0.00%`;
            }

            resultsHTML += `
                <div class="result-item">
                    <span>è©¦ç®—å¾Œæç›Šï¼š</span>
                    <span class="${profitClass}">${profitAmountText}</span>
                </div>
                <div class="result-item">
                    <span>æç›Šç‡ï¼š</span>
                    <span class="${profitClass}">${profitRateText}</span>
                </div>
            `;
        }

        resultsHTML += `
            </div>
        `;

        // æ›´æ–°çµæœå®¹å™¨
        resultsContainer.innerHTML = resultsHTML;
        resultsContainer.style.display = 'block';
        
        // è·¨å¹³å°æ»¾å‹•åˆ°çµæœå€åŸŸ
        try {
            resultsContainer.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        } catch (e) {
            // é™ç´šè™•ç†ï¼šç›´æ¥æ»¾å‹•
            resultsContainer.scrollIntoView();
        }
    }
</script>
```

</body>
</html>
